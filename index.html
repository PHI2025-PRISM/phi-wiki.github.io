<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ£±é•œé‡å·¥Wiki - çŸ¥è¯†åº“</title>
    <!-- å¼•å…¥Marked.jsåº“ç”¨äºè§£æMarkdown -->
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <!-- å¼•å…¥Highlight.jsç”¨äºä»£ç é«˜äº® -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/highlight.js/styles/github.css">
    <script src="https://cdn.jsdelivr.net/npm/highlight.js/lib/highlight.min.js"></script>
    <!-- å¼•å…¥Lunr.jsç”¨äºæœç´¢ -->
    <script src="https://cdn.jsdelivr.net/npm/lunr/lunr.min.js"></script>
    <style>
            /* åŸºç¡€æ ·å¼ */
        :root {
            --primary-color: #2c3e50;
            --secondary-color: #3498db;
            --accent-color: #e74c3c;
            --light-color: #ecf0f1;
            --dark-color: #34495e;
            --text-color: #333;
            --border-radius: 6px;
            --shadow: 0 4px 12px rgba(0, 0, 0, 0.5);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            line-height: 1.6;
            color: var(--text-color);
            background-color: #f9f9f9;
            display: flex;
            flex-direction: column;
            min-height: 100vh;
        }

        /* å¤´éƒ¨æ ·å¼ */
        header {
            background-color: var(--primary-color);
            color: white;
            padding: 1rem 2rem;
            box-shadow: var(--shadow);
            position: sticky;
            top: 0;
            z-index: 1000;
            flex-shrink: 0; /* é˜²æ­¢è¢«å‹ç¼© */
        }

        .header-content {
            max-width: 1200px;
            margin: 0 auto;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .logo {
            font-size: 1.5rem;
            font-weight: bold;
        }

            .logo span {
                color: var(--secondary-color);
            }

        nav ul {
            display: flex;
            list-style: none;
        }

        nav li {
            margin-left: 1.5rem;
        }

        nav a {
            color: white;
            text-decoration: none;
            transition: color 0.3s;
        }

            nav a:hover {
                color: var(--secondary-color);
            }

        /* ä¸»ä½“å†…å®¹æ ·å¼ */
        .container {
            display: flex;
            max-width: 1200px;
            margin: 2rem auto;
            flex: 1;
            gap: 2rem;
            padding: 0 1rem;
            min-height: 0; /* å…³é”®ï¼šå…è®¸å®¹å™¨ç¼©å° */
        }

        /* ä¾§è¾¹æ æ ·å¼ */
        .sidebar {
            width: 280px;
            background-color: white;
            border-radius: var(--border-radius);
            box-shadow: var(--shadow);
            padding: 1.5rem;
            align-self: flex-start;
            /* åŠ¨æ€æ‰©å±•ä¾§è¾¹æ  */
            max-height: calc(100vh - 200px);
            overflow-y: auto;
            position: sticky;
            top: 20px;
            /* è¿‡æ¸¡æ•ˆæœ */
            transition: max-height 0.3s ease;
            flex-shrink: 0;
        }

        .sidebar.expanded {
            max-height: calc(100vh - 100px);
        }

        .sidebar-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1rem;
        }

        .sidebar h3 {
            padding-bottom: 0.5rem;
            border-bottom: 2px solid var(--secondary-color);
            flex: 1;
        }

        .search-toggle {
            background: none;
            border: none;
            color: var(--secondary-color);
            cursor: pointer;
            font-size: 1.2rem;
            margin-left: 0.5rem;
            padding: 0.2rem;
            border-radius: 3px;
            transition: background-color 0.3s;
        }

            .search-toggle:hover {
                background-color: var(--light-color);
            }

        .search-box {
            margin-bottom: 1.5rem;
            position: relative;
            display: none; /* é»˜è®¤éšè— */
        }

            .search-box.active {
                display: block; /* æ¿€æ´»æ—¶æ˜¾ç¤º */
            }

            .search-box input {
                width: 100%;
                padding: 0.5rem 2.5rem 0.5rem 0.75rem;
                border: 1px solid #ddd;
                border-radius: var(--border-radius);
                font-size: 0.9rem;
            }

                .search-box input:focus {
                    outline: none;
                    border-color: var(--secondary-color);
                    box-shadow: 0 0 0 2px rgba(52, 152, 219, 0.2);
                }

        .search-icon {
            position: absolute;
            right: 0.75rem;
            top: 50%;
            transform: translateY(-50%);
            color: #999;
        }

        .search-results {
            position: absolute;
            top: 100%;
            left: 0;
            right: 0;
            background: white;
            border: 1px solid #ddd;
            border-radius: 0 0 var(--border-radius) var(--border-radius);
            box-shadow: var(--shadow);
            z-index: 10;
            max-height: 300px;
            overflow-y: auto;
            display: none;
        }

            .search-results.active {
                display: block;
            }

        .search-result-item {
            padding: 0.75rem;
            border-bottom: 1px solid #eee;
            cursor: pointer;
            transition: background-color 0.2s;
        }

            .search-result-item:hover {
                background-color: var(--light-color);
            }

            .search-result-item:last-child {
                border-bottom: none;
            }

        .search-result-title {
            font-weight: bold;
            margin-bottom: 0.25rem;
        }

        .search-result-excerpt {
            font-size: 0.8rem;
            color: #666;
        }

        /* é¡µè„šæ ·å¼ */
        footer {
            background-color: var(--primary-color);
            color: white;
            text-align: center;
            padding: 1.5rem;
            margin-top: auto; /* å…³é”®ï¼šç¡®ä¿é¡µè„šåœ¨åº•éƒ¨ */
            flex-shrink: 0; /* é˜²æ­¢è¢«å‹ç¼© */
        }

        /* åµŒå¥—èœå•æ ·å¼ */
        .sidebar-category {
            margin-bottom: 0.5rem;
        }

        .category-header {
            cursor: pointer;
            padding: 0.5rem;
            font-weight: bold;
            color: var(--dark-color);
            display: flex;
            justify-content: space-between;
            align-items: center;
            transition: background-color 0.3s;
            border-radius: 4px;
        }

            .category-header:hover {
                background-color: var(--light-color);
            }

        .category-arrow {
            font-size: 0.8rem;
            transition: transform 0.3s;
        }

        .category-header.expanded .category-arrow {
            transform: rotate(90deg);
        }

        .category-doc-list {
            margin-left: 1rem;
            list-style: none;
            overflow: hidden;
            transition: max-height 0.3s ease-out;
            max-height: 0;
        }

            .category-doc-list.expanded {
                max-height: 1000px; 
                overflow-y: auto;
            }

            .category-doc-list li {
                margin-bottom: 0.25rem;
            }

            .category-doc-list a {
                color: var(--text-color);
                text-decoration: none;
                display: block;
                padding: 0.25rem 0.5rem;
                border-radius: 4px;
                transition: background-color 0.3s;
                font-size: 0.9rem;
            }

                .category-doc-list a:hover {
                    background-color: var(--light-color);
                }

                .category-doc-list a.active {
                    background-color: var(--secondary-color);
                    color: white;
                }
        
        /* äºŒçº§åµŒå¥—èœå•æ ·å¼ */
        .subcategory {
            margin-left: 0.5rem;
        }

        .subcategory-header {
            cursor: pointer;
            padding: 0.4rem 0.5rem;
            font-weight: 600;
            color: var(--dark-color);
            display: flex;
            justify-content: space-between;
            align-items: center;
            transition: background-color 0.3s;
            border-radius: 4px;
            font-size: 0.9rem;
        }

            .subcategory-header:hover {
                background-color: var(--light-color);
            }

        .subcategory-arrow {
            font-size: 0.7rem;
            transition: transform 0.3s;
        }

        .subcategory-header.expanded .subcategory-arrow {
            transform: rotate(90deg);
        }

        .subcategory-doc-list {
            margin-left: 1rem;
            list-style: none;
            overflow: hidden;
            transition: max-height 0.3s ease-out;
            max-height: 0;
        }

            .subcategory-doc-list.expanded {
                max-height: 800px;
                overflow-y: auto;
            }

            .subcategory-doc-list li {
                margin-bottom: 0.2rem;
            }

            .subcategory-doc-list a {
                color: var(--text-color);
                text-decoration: none;
                display: block;
                padding: 0.2rem 0.5rem;
                border-radius: 4px;
                transition: background-color 0.3s;
                font-size: 0.85rem;
            }

                .subcategory-doc-list a:hover {
                    background-color: var(--light-color);
                }

                .subcategory-doc-list a.active {
                    background-color: var(--secondary-color);
                    color: white;
                }

        /* ä¸‰çº§åµŒå¥—èœå•æ ·å¼ */
        .subsubcategory {
            margin-left: 0.5rem;
        }

        .subsubcategory-header {
            cursor: pointer;
            padding: 0.35rem 0.5rem;
            font-weight: 500;
            color: var(--dark-color);
            display: flex;
            justify-content: space-between;
            align-items: center;
            transition: background-color 0.3s;
            border-radius: 4px;
            font-size: 0.85rem;
        }

            .subsubcategory-header:hover {
                background-color: var(--light-color);
            }

        .subsubcategory-arrow {
            font-size: 0.65rem;
            transition: transform 0.3s;
        }

        .subsubcategory-header.expanded .subsubcategory-arrow {
            transform: rotate(90deg);
        }

        .subsubcategory-doc-list {
            margin-left: 1rem;
            list-style: none;
            overflow: hidden;
            transition: max-height 0.3s ease-out;
            max-height: 0;
        }

            .subsubcategory-doc-list.expanded {
                max-height: 600px;
                overflow-y: auto;
            }

            .subsubcategory-doc-list li {
                margin-bottom: 0.15rem;
            }

            .subsubcategory-doc-list a {
                color: var(--text-color);
                text-decoration: none;
                display: block;
                padding: 0.15rem 0.5rem;
                border-radius: 4px;
                transition: background-color 0.3s;
                font-size: 0.8rem;
            }

                .subsubcategory-doc-list a:hover {
                    background-color: var(--light-color);
                }

                .subsubcategory-doc-list a.active {
                    background-color: var(--secondary-color);
                    color: white;
                }
        
         /* å››çº§åµŒå¥—èœå•æ ·å¼ */
        .subsubsubcategory {
            margin-left: 0.5rem;
        }

        .subsubsubcategory-header {
            cursor: pointer;
            padding: 0.3rem 0.5rem;
            font-weight: 500;
            color: var(--dark-color);
            display: flex;
            justify-content: space-between;
            align-items: center;
            transition: background-color 0.3s;
            border-radius: 4px;
            font-size: 0.8rem;
        }

            .subsubsubcategory-header:hover {
                background-color: var(--light-color);
            }

        .subsubsubcategory-arrow {
            font-size: 0.6rem;
            transition: transform 0.3s;
        }

        .subsubsubcategory-header.expanded .subsubsubcategory-arrow {
            transform: rotate(90deg);
        }

        .subsubsubcategory-doc-list {
            margin-left: 1rem;
            list-style: none;
            overflow: hidden;
            transition: max-height 0.3s ease-out;
            max-height: 0;
        }

            .subsubsubcategory-doc-list.expanded {
                max-height: 500px;
                overflow-y: auto;
            }

            .subsubsubcategory-doc-list li {
                margin-bottom: 0.1rem;
            }

            .subsubsubcategory-doc-list a {
                color: var(--text-color);
                text-decoration: none;
                display: block;
                padding: 0.1rem 0.5rem;
                border-radius: 4px;
                transition: background-color 0.3s;
                font-size: 0.75rem;
            }

                .subsubsubcategory-doc-list a:hover {
                    background-color: var(--light-color);
                }

                .subsubsubcategory-doc-list a.active {
                    background-color: var(--secondary-color);
                    color: white;
                }


        /* ä¸»å†…å®¹åŒºæ ·å¼ */
        .main-content {
            flex: 1;
            background-color: white;
            border-radius: var(--border-radius);
            box-shadow: var(--shadow);
            padding: 2rem;
            overflow-wrap: break-word;
            word-break: break-word;
            min-width: 0; /* å…³é”®ï¼šå…è®¸å†…å®¹åŒºåŸŸç¼©å° */
        }

            .main-content h1 {
                margin-bottom: 1.5rem;
                color: var(--primary-color);
                border-bottom: 2px solid var(--light-color);
                padding-bottom: 0.5rem;
            }

            .main-content h2 {
                margin: 1.5rem 0 1rem;
                color: var(--dark-color);
            }

            .main-content h3 {
                margin: 1.2rem 0 0.8rem;
            }

            .main-content p {
                margin-bottom: 1rem;
            }

            .main-content ul, .main-content ol {
                margin-bottom: 1rem;
                padding-left: 1.5rem;
            }

            .main-content li {
                margin-bottom: 0.5rem;
            }

            .main-content code {
                background-color: var(--light-color);
                padding: 0.2rem 0.4rem;
                border-radius: 3px;
                font-family: 'Courier New', monospace;
            }

            .main-content pre {
                background-color: #f6f8fa;
                padding: 1rem;
                border-radius: var(--border-radius);
                overflow-x: auto;
                margin-bottom: 1rem;
                border: 1px solid #e1e4e8;
            }

                .main-content pre code {
                    background: none;
                    padding: 0;
                }

            .main-content blockquote {
                border-left: 4px solid var(--secondary-color);
                padding-left: 1rem;
                margin: 1rem 0;
                color: var(--dark-color);
                font-style: italic;
            }

        .breadcrumb {
            margin-bottom: 1.5rem;
            font-size: 0.9rem;
            color: var(--dark-color);
        }

            .breadcrumb a {
                color: var(--secondary-color);
                text-decoration: none;
            }

        /* åŠ è½½çŠ¶æ€æ ·å¼ */
        .loading {
            text-align: center;
            padding: 2rem;
            color: var(--dark-color);
        }

        .spinner {
            border: 4px solid rgba(0, 0, 0, 0.1);
            border-left-color: var(--secondary-color);
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 0 auto 1rem;
        }

        @keyframes spin {
            to {
                transform: rotate(360deg);
            }
        }

        /* é”™è¯¯çŠ¶æ€æ ·å¼ */
        .error {
            background-color: #ffeaea;
            border: 1px solid #ffcccc;
            border-radius: var(--border-radius);
            padding: 1.5rem;
            margin-bottom: 1rem;
            color: #d63031;
        }

        /* æ·»åŠ è¡¨æ ¼æ ·å¼ */
        .main-content table {
            border-collapse: collapse;
            width: 100%;
            margin-bottom: 1rem;
            border: 1px solid #ddd;
        }

        .main-content th, .main-content td {
            padding: 0.75rem;
            border: 1px solid #ddd;
            text-align: left;
        }

        .main-content th {
            background-color: var(--light-color);
            font-weight: bold;
        }

        .main-content tr:nth-child(even) {
            background-color: #f9f9f9;
        }

        .main-content tr:hover {
            background-color: #f5f5f5;
        }

        /* å“åº”å¼è¡¨æ ¼ */
        @media (max-width: 768px) {
            .main-content table {
                display: block;
                overflow-x: auto;
            }
        }

        /* å“åº”å¼è®¾è®¡ - ä¿®å¤ç§»åŠ¨ç«¯å¸ƒå±€é—®é¢˜ */
        @media (max-width: 768px) {
            body {
                /* ç¡®ä¿bodyå¯ä»¥æ­£å¸¸æ»šåŠ¨ */
                overflow-x: hidden;
                min-height: 100vh;
                position: relative;
            }
            
            /* ä¿®å¤å®¹å™¨å¸ƒå±€ */
            .container {
                flex-direction: column;
                margin: 1rem auto;
                padding: 0 1rem;
                width: 100%;
                max-width: 100%;
            }
            
            /* ä¾§è¾¹æ åœ¨ç§»åŠ¨ç«¯å æ»¡å®½åº¦ */
            .sidebar {
                width: 100%;
                position: static;
                max-height: none;
                overflow-y: visible;
                margin-bottom: 1rem;
                padding: 1rem;
                top: auto;
            }
            
            .sidebar.expanded {
                max-height: none;
            }
            
            /* ä¿®å¤å¤´éƒ¨å¸ƒå±€ */
            .header-content {
                flex-direction: column;
                text-align: center;
                padding: 0.5rem 0;
            }
            
            .logo {
                margin-bottom: 0.5rem;
                font-size: 1.3rem;
            }
            
            nav ul {
                margin-top: 0.5rem;
                justify-content: center;
                flex-wrap: wrap;
            }
            
            nav li {
                margin: 0 0.5rem 0.5rem;
            }
            
            /* ä¿®å¤ä¸»å†…å®¹åŒºåŸŸ */
            .main-content {
                padding: 1.5rem;
                margin-bottom: 2rem;
                width: 100%;
                overflow: visible;
            }
            
            /* ç§»åŠ¨ç«¯ä¼˜åŒ–æœç´¢æ¡† */
            .search-box.active {
                display: block;
            }
            
            /* ç§»åŠ¨ç«¯ä¼˜åŒ–æœç´¢ç»“æœ */
            .search-results {
                position: fixed;
                top: 50%;
                left: 10px;
                right: 10px;
                max-height: 60vh;
                transform: translateY(-50%);
                z-index: 1000;
            }
            
            /* ç§»åŠ¨ç«¯é™åˆ¶åµŒå¥—èœå•çš„æœ€å¤§é«˜åº¦ */
            .category-doc-list.expanded,
            .subcategory-doc-list.expanded,
            .subsubcategory-doc-list.expanded,
            .subsubsubcategory-doc-list.expanded {
                max-height: 300px;
                overflow-y: auto;
            }
            
            /* ç¡®ä¿é¢åŒ…å±‘å¯¼èˆªåœ¨ç§»åŠ¨ç«¯ä¸æº¢å‡º */
            .breadcrumb {
                overflow-x: auto;
                white-space: nowrap;
                padding-bottom: 0.5rem;
                margin-bottom: 1rem;
            }
            
            /* ä¿®å¤ç§»åŠ¨ç«¯æ ‡é¢˜å¤§å° */
            .main-content h1 {
                font-size: 1.5rem;
                line-height: 1.3;
            }
            
            .main-content h2 {
                font-size: 1.3rem;
            }
            
            .main-content h3 {
                font-size: 1.1rem;
            }
            
            /* ç¡®ä¿é•¿å†…å®¹ä¸ä¼šæº¢å‡º */
            .main-content p,
            .main-content li {
                word-break: break-word;
            }
            
            .main-content pre {
                overflow-x: auto;
                -webkit-overflow-scrolling: touch;
            }
        }
        
        /* é’ˆå¯¹å°å±å¹•æ‰‹æœºçš„é¢å¤–ä¼˜åŒ– */
        @media (max-width: 480px) {
            .container {
                padding: 0 0.5rem;
            }
            
            .main-content {
                padding: 1rem;
            }
            
            .sidebar {
                padding: 0.75rem;
            }
            
            .logo {
                font-size: 1.2rem;
            }
            
            nav li {
                margin: 0 0.25rem 0.25rem;
            }
            
            nav a {
                font-size: 0.9rem;
            }
            
            .breadcrumb {
                font-size: 0.85rem;
            }
            
            .main-content h1 {
                font-size: 1.4rem;
            }
        }
        
        /* é’ˆå¯¹ç§»åŠ¨ç«¯æ»šåŠ¨ä¼˜åŒ– */
        @media (hover: none) and (pointer: coarse) {
            /* ä¸ºè§¦æ‘¸è®¾å¤‡ä¼˜åŒ–æ»šåŠ¨ */
            .main-content {
                -webkit-overflow-scrolling: touch;
            }
            
            .category-doc-list,
            .subcategory-doc-list,
            .subsubcategory-doc-list,
            .subsubsubcategory-doc-list {
                -webkit-overflow-scrolling: touch;
            }
            
            /* å¢åŠ è§¦æ‘¸ç›®æ ‡å¤§å° */
            .doc-link,
            .nav-link,
            .category-header,
            .subcategory-header,
            .subsubcategory-header,
            .subsubsubcategory-header {
                min-height: 44px;
                padding-top: 12px;
                padding-bottom: 12px;
            }
        }
    </style>
</head>
<body>
    <!-- ç½‘ç«™å¤´éƒ¨ -->
    <header>
        <div class="header-content">
            <div class="logo">æ£±é•œé‡å·¥<span>Wiki</span></div>
            <nav>
                <ul>
                    <li><a href="#" class="nav-link" data-doc="home">é¦–é¡µ</a></li>
                    <li><a href="#" class="nav-link" data-doc="docs">æ–‡æ¡£</a></li>
                    <li><a href="#" class="nav-link" data-doc="contributing">è´¡çŒ®æŒ‡å—</a></li>
                    <li><a href="#" class="nav-link" data-doc="api">API</a></li>
                    <li><a href="#" class="nav-link" data-doc="about">å…³äº</a></li>
                </ul>
            </nav>
        </div>
    </header>

    <!-- ä¸»ä½“å†…å®¹åŒº -->
    <div class="container">
        <!-- ä¾§è¾¹æ å¯¼èˆª -->
        <aside class="sidebar">
            <div class="sidebar-header">
                <h3>æ–‡æ¡£ç›®å½•</h3>
                <button class="search-toggle" title="æœç´¢æ–‡æ¡£">ğŸ”</button>
            </div>

            <!-- æœç´¢æ¡† -->
            <div class="search-box" id="search-box">
                 <input type="text" id="search-input" placeholder="æœç´¢æ–‡æ¡£...">
                 
                <div class="search-results" id="search-results"></div>
             </div>

            <ul id="doc-menu">
                <!-- åµŒå¥—èœå•å°†é€šè¿‡JavaScriptåŠ¨æ€ç”Ÿæˆ -->
            </ul>
        </aside>

        <!-- ä¸»å†…å®¹åŒº -->
        <main class="main-content">
            <!-- é¢åŒ…å±‘å¯¼èˆª -->
            <div class="breadcrumb" id="breadcrumb">
                <a href="#" data-doc="home">é¦–é¡µ</a>
            </div>

            <!-- é¡µé¢æ ‡é¢˜ -->
            <h1 id="page-title">æ¬¢è¿ä½¿ç”¨æ£±é•œé‡å·¥Wiki</h1>

            <!-- å†…å®¹åŒºåŸŸ -->
            <div id="content">
                <!-- åˆå§‹åŠ è½½å†…å®¹ -->
                <div class="loading">
                    <div class="spinner"></div>
                    <p>æ­£åœ¨åŠ è½½å†…å®¹...</p>
                </div>
            </div>
        </main>
    </div>

    <!-- ç½‘ç«™é¡µè„š -->
    <footer>
        <div class="header-content" style="padding: 0.75rem 1rem;">
            <div style="width:100%; display:flex; justify-content:center; align-items:center; gap:0.5rem;">
                <div style="font-size:0.95rem;">&copy; 2025 æ£±é•œé‡å·¥Wiki - ç”± GitHub Pages é©±åŠ¨ Â· <a href="https://creativecommons.org/licenses/by-sa/4.0/" target="_blank" rel="noopener noreferrer">æœ¬wikiéµå¾ªCC BY-SA-4.0è®¸å¯è¯</a></div>
            </div>
        </div>
    </footer>

    <script>
        // æ–‡æ¡£é…ç½® - åœ¨è¿™é‡Œæ·»åŠ æ–°çš„æ–‡æ¡£
        const docConfig = {
            // æ–‡æ¡£èœå•ç»“æ„
            menu: [
                { id: "home", title: "é¦–é¡µ", file: "docs/home.md" },
                { id: "getting-started", title: "å¿«é€Ÿå¼€å§‹", file: "docs/getting-started.md" },
                { id: "code-of-conduct", title: "è¡Œä¸ºå‡†åˆ™", file: "docs/Code-of-Conduct.md" },
                { id: "Update-Log", title: "æ›´æ–°æ—¥å¿—", file: "docs/Update-Log.md" },
                { id: "contributing", title: "è´¡çŒ®æŒ‡å—", file: "docs/contributing.md" },
                { id: "faq", title: "å¸¸è§é—®é¢˜", file: "docs/faq.md" },
                { id: "about", title: "å…³äº", file: "docs/about.md"},
                
                // è§’è‰²åˆ†ç±»
                { id: "edward-riley", title: "çˆ±å¾·åÂ·è±åˆ©", file: "docs/phi-role/Edward-Riley.md" },
                { id: "talia-riley", title: "å¡”è‰å¨…Â·è±åˆ©", file: "docs/phi-role/Talia-Riley.md" },
                { id: "philythia-lanthes", title: "è²è‰èŒœå¨…Â·å…°ç‘Ÿæ–¯", file: "docs/phi-role/Philythia-Lanthes.md" },
                
                // æ•…äº‹åˆ†ç±»
                { id: "farewell-war", title: "æ°¸åˆ«äº†ï¼Œæˆ˜äº‰", file: "docs/story/Farewell-War.md" },
                { id: "polarized-light", title: "åæŒ¯å…‰", file: "docs/story/polarized-light.md" },
                { id: "danger-zone", title: "å±é™©åœ°å¸¦", file: "docs/story/Danger-Zone.md" },

                // ã€Šæ°¸åˆ«äº†ï¼Œæˆ˜äº‰ã€‹ç« èŠ‚
                { id: "farewell-war-chapter1", title: "ç¬¬ä¸€ç« ï¼šèµ«å°”è¾›åŸºçš„é˜´å½±", file: "docs/story/farewell-war/chapter1.md" },
                { id: "farewell-war-chapter2", title: "ç¬¬äºŒç« ï¼šç©ºç—•ä¸å›å“", file: "docs/story/farewell-war/chapter2.md" },
                { id: "farewell-war-chapter3", title: "ç¬¬ä¸‰ç« ï¼šä»¥å¤ªå›å“é‡Œçš„å®‰é­‚æ›²", file: "docs/story/farewell-war/chapter3.md" },
                { id: "farewell-war-chapter4", title: "ç¬¬å››ç« ï¼šé›ªåŸä¸Šçš„ä¿¡æ ‡", file: "docs/story/farewell-war/chapter4.md" },
                { id: "farewell-war-chapter5", title: "ç¬¬äº”ç« ï¼šå¯‚é™çš„å›å£°", file: "docs/story/farewell-war/chapter5.md" },
                
                // ç‰©å“åˆ†ç±»
                //ææ–™
                { id: "nihilith", title: "è«ä¼¦æ™¶", file: "docs/thing/material/Nihilith.md" },
                { id: "MÃ¶bius-alloy", title: "è«æ¯”ä¹Œæ–¯åˆé‡‘", file: "docs/thing/material/MÃ¶bius-alloy.md" },
                //è£…å¤‡
                /*å½±å­æˆ˜æœ¯æ¨¡å—åŒ–æ¶æ„*/
                { id: "peregrine-tss", title: "â€œæ¸¸éš¼â€æˆ˜æœ¯ç²¾ç¡®ç‹™å‡»ç³»ç»Ÿ", file: "docs/thing/equipment/stma/peregrine-tss.md" },
                { id: "aether-cloak", title: "ä»¥å¤ªæŠ«é£", file: "docs/thing/equipment/stma/Aether-Cloak.md" },
                { id: "night-owl-cqb", title: "â€œå¤œæ­â€ç´§å‡‘å‹æˆ˜æœ¯æ­¦å™¨ç³»ç»Ÿ", file: "docs/thing/equipment/stma/night-owl-cqb.md" },
                { id: "mastiff-lsw", title: "â€œç’çŠ¬â€è½»å‹æ”¯æ´æ­¦å™¨ç³»ç»Ÿ", file: "docs/thing/equipment/stma/mastiff-lsw.md" },
                //è½½å…·
                { id: "arcLight-sts", title: "â€œå¼§å…‰â€æˆ˜ç•¥è¿è¾“æœº", file: "docs/thing/vehicle/ArcLight-STS.md" },

                // ä¸–ç•Œè§‚åˆ†ç±»
                //ç»„ç»‡
                { id: "phi-introduce", title: "æ£±é•œé‡å·¥", file: "docs/worldview/phi-introduce.md" },
                { id: "sea-church-introduce", title: "æ·±æµ·æ•™ä¼š", file: "docs/worldview/sea-church-introduce.md" },
                { id: "MÃ¶bius-Legion-introduce", title: "è«æ¯”ä¹Œæ–¯å†›å›¢", file: "docs/worldview/MÃ¶bius-Legion-introduce.md" },
                //æ¦‚å¿µ
                { id: "ees", title: "é™æ»ç—…", file: "docs/worldview/EES.md"},
                { id: "a-c-c-e-s-s", title: "A.C.C.E.S.S.", file: "docs/worldview/A-C-C-E-S-S.md"}
            ],

            // é»˜è®¤æ–‡æ¡£
            defaultDoc: "home"
        };

        // æœç´¢ç´¢å¼•å’Œæ–‡æ¡£å­˜å‚¨
        let currentExpandedCategory = null;
        let searchIndex = null;
        let documents = [];

        // åˆå§‹åŒ–å‡½æ•°
        document.addEventListener('DOMContentLoaded', function () {
            console.log("åˆå§‹åŒ–å¼€å§‹...");

            // é…ç½®Markedé€‰é¡¹
            marked.setOptions({
                highlight: function (code, lang) {
                    try {
                        if (typeof hljs !== 'undefined') {
                            // å…¼å®¹ä¸åŒç‰ˆæœ¬çš„highlight.js API
                            if (lang && hljs.getLanguage && hljs.getLanguage(lang)) {
                                if (typeof hljs.highlight === 'function') {
                                    // æ–°API: hljs.highlight(code, {language: lang})
                                    return hljs.highlight(code, { language: lang }).value;
                                } else if (typeof hljs.highlightAuto === 'function') {
                                    return hljs.highlightAuto(code).value;
                                } else if (typeof hljs.highlightBlock === 'function') {
                                    // æ—§APIï¼ˆé™çº§ï¼‰
                                    return hljs.highlightBlock(code) || code;
                                }
                            }

                            if (typeof hljs.highlightAuto === 'function') {
                                return hljs.highlightAuto(code).value;
                            }
                        }
                    } catch (e) {
                        // å¦‚æœé«˜äº®å¤±è´¥ï¼Œè¿”å›åŸå§‹ä»£ç æ–‡æœ¬ä»¥é˜²æ­¢æŠ›å‡ºé”™è¯¯
                        console.warn('ä»£ç é«˜äº®å¤±è´¥ï¼š', e);
                    }

                    return code;
                },
                breaks: true, // å¯ç”¨æ¢è¡Œç¬¦æ”¯æŒ
                gfm: true, // å¯ç”¨GitHubé£æ ¼çš„Markdown
                tables: true, // å¯ç”¨è¡¨æ ¼æ”¯æŒ
                pedantic: false, // é¿å…è¿‡äºä¸¥æ ¼çš„è§£æ
                smartLists: true, // æ™ºèƒ½åˆ—è¡¨
                smartypants: true // æ™ºèƒ½æ ‡ç‚¹
            });

            // å…¼å®¹æ€§åˆå§‹åŒ–é«˜äº®ï¼ˆä¼˜å…ˆæ–°APIï¼‰
            if (typeof hljs !== 'undefined') {
                if (typeof hljs.highlightAll === 'function') {
                    hljs.highlightAll();
                } else if (typeof hljs.initHighlightingOnLoad === 'function') {
                    hljs.initHighlightingOnLoad();
                }
            }

            // æ„å»ºåµŒå¥—æ–‡æ¡£èœå•
            buildNestedDocMenu();

            // è®¾ç½®è·¯ç”±
            setupRouting();

            // åˆå§‹åŒ–æœç´¢åŠŸèƒ½ï¼ˆå¿…é¡»åœ¨åŠ è½½æ–‡æ¡£ä¹‹å‰åˆå§‹åŒ–ç´¢å¼•ï¼Œé¿å… race conditionï¼‰
            initSearch();

            // è®¾ç½®å¯¼èˆªäº‹ä»¶
            setupNavigation();

            // åŠ è½½åˆå§‹æ–‡æ¡£
            loadDocument(getCurrentDoc());

            console.log("åˆå§‹åŒ–å®Œæˆ");
        });
        // æ„å»ºåµŒå¥—æ–‡æ¡£èœå•
        function buildNestedDocMenu() {
            const menuContainer = document.getElementById('doc-menu');
            menuContainer.innerHTML = '';

            // åˆ›å»ºæ–‡æ¡£æ˜ å°„
            const docMap = {};
            docConfig.menu.forEach(doc => {
                docMap[doc.id] = doc;
            });

            // å®šä¹‰åµŒå¥—ç»“æ„
            const nestedStructure = {
                "å…¥é—¨æŒ‡å—": {
                    "home": "é¦–é¡µ",
                    "getting-started": "å¿«é€Ÿå¼€å§‹",
                     "faq": "å¸¸è§é—®é¢˜"
                },
                "æ•…äº‹": {
                    "ä¸»çº¿æ•…äº‹": {
                        "æ°¸åˆ«äº†ï¼Œæˆ˜äº‰": {
                            "ç« èŠ‚": {
                                "farewell-war-chapter1": "ç¬¬ä¸€ç« ï¼šèµ«å°”è¾›åŸºçš„é˜´å½±",
                                "farewell-war-chapter2": "ç¬¬äºŒç« ï¼šç©ºç—•ä¸å›å“", 
                                "farewell-war-chapter3": "ç¬¬ä¸‰ç« ï¼šä»¥å¤ªå›å“é‡Œçš„å®‰é­‚æ›²",
                                "farewell-war-chapter4": "ç¬¬å››ç« ï¼šé›ªåŸä¸Šçš„ä¿¡æ ‡",
                                "farewell-war-chapter5": "ç¬¬äº”ç« ï¼šå¯‚é™çš„å›å£°"
                            },
                            "è§’è‰²åˆ†æ": {
                                "farewell-war-characters-main": "ä¸»è¦è§’è‰²",
                                "farewell-war-characters-side": "æ¬¡è¦è§’è‰²"
                            },
                            "èƒŒæ™¯è®¾å®š": {
                                "farewell-war-setting-time": "æ—¶é—´çº¿",
                                "farewell-war-setting-location": "åœ°ç‚¹"
                            }
                        },
                         "åæŒ¯å…‰": {
                            "ç« èŠ‚": {
                            "polarized-light-chapter1": "ç¬¬ä¸€ç« ï¼šå…‰ä¹‹å§‹",
                            "polarized-light-chapter2": "ç¬¬äºŒç« ï¼šæŠ˜å°„çš„å‘½è¿",
                         }
                    }
                },
                    "æ”¯çº¿æ•…äº‹": {
                        "danger-zone": "å±é™©åœ°å¸¦"
                    }
                },
                "è§’è‰²": {
                    "ä¸»è¦è§’è‰²": {
                        "philythia-lanthes": "è²è‰èŒœå¨…Â·å…°ç‘Ÿæ–¯",
                        "edward-riley": "çˆ±å¾·åÂ·è±åˆ©"
                    },
                    "æ¬¡è¦è§’è‰²": {
                        "talia-riley": "å¡”è‰å¨…Â·è±åˆ©"
                    }
                },
                "ç‰©å“": {
                    "ææ–™": {
                        "nihilith": "è«ä¼¦æ™¶",
                        "MÃ¶bius-alloy": "è«æ¯”ä¹Œæ–¯åˆé‡‘"
                    },
                    "è£…å¤‡": {
                        "å½±å­æˆ˜æœ¯æ¨¡å—åŒ–ç³»ç»Ÿ": {
                            "aether-cloak": "ä»¥å¤ªæŠ«é£",
                            "night-owl-cqb": "â€œå¤œæ­â€ç´§å‡‘å‹æˆ˜æœ¯æ­¦å™¨ç³»ç»Ÿ",
                            "mastiff-lsw": "â€œç’çŠ¬â€è½»å‹æ”¯æ´æ­¦å™¨ç³»ç»Ÿ",
                            "peregrine-tss": "â€œæ¸¸éš¼â€æˆ˜æœ¯ç²¾ç¡®ç‹™å‡»ç³»ç»Ÿ"
                    },
                },
                "è½½å…·": {
                    "arcLight-sts": "â€œå¼§å…‰â€æˆ˜ç•¥è¿è¾“æœº"
                    },
                    
                },
                "ä¸–ç•Œè§‚": {
                    "ç»„ç»‡": {
                        "phi-introduce": "æ£±é•œé‡å·¥",
                        "sea-church-introduce": "æ·±æµ·æ•™ä¼š",
                        "MÃ¶bius-Legion-introduce": "è«æ¯”ä¹Œæ–¯å†›å›¢"
                    },
                    "æ¦‚å¿µ": {
                        "ees": "é™æ»ç—…",
                        "a-c-c-e-s-s": "A.C.C.E.S.S."
                    }
                },
                "å¼€å‘ä¸ç¤¾åŒº": {
                    "Update-Log": "æ›´æ–°æ—¥å¿—",
                    "contributing": "è´¡çŒ®æŒ‡å—",
                    "code-of-conduct": "è¡Œä¸ºå‡†åˆ™"
                }
            };

            // æ·»åŠ æ–‡æ¡£æ˜ å°„åˆ°å…¨å±€å˜é‡ï¼Œæ–¹ä¾¿å…¶ä»–å‡½æ•°è®¿é—®
            window.docMap = docMap;

            Object.entries(nestedStructure).forEach(([category, categoryItems]) => {
                // åˆ›å»ºåˆ†ç±»å®¹å™¨
                const categoryItem = document.createElement('li');
                categoryItem.className = 'sidebar-category';
                categoryItem.setAttribute('data-category', category);

                // åˆ›å»ºåˆ†ç±»æ ‡é¢˜ï¼ˆå¯ç‚¹å‡»å±•å¼€/æŠ˜å ï¼‰
                const categoryHeader = document.createElement('div');
                categoryHeader.className = 'category-header';
                categoryHeader.innerHTML = `
                        <span>${category}</span>
                        <span class="category-arrow">â–¶</span>
                    `;

                // åˆ›å»ºæ–‡æ¡£åˆ—è¡¨å®¹å™¨
                const docList = document.createElement('ul');
                docList.className = 'category-doc-list collapsed';

                // é€’å½’æ·»åŠ é¡¹ç›®
                addItemsToMenu(docList, categoryItems, 1, docMap);

                // ç‚¹å‡»åˆ†ç±»æ ‡é¢˜å±•å¼€/æŠ˜å 
                categoryHeader.addEventListener('click', function () {
                    const isExpanded = docList.classList.contains('expanded');

                    if (!isExpanded) {
                        collapseAllMainCategories(category);
                    }
                    if (isExpanded) {
                        docList.classList.remove('expanded');
                        docList.classList.add('collapsed');
                        categoryHeader.classList.remove('expanded');
                        currentExpandedCategory = null;
                        checkSidebarCollapse(); // æ£€æŸ¥æ˜¯å¦éœ€è¦æŠ˜å ä¾§è¾¹æ 
                    } else {
                        docList.classList.remove('collapsed');
                        docList.classList.add('expanded');
                        categoryHeader.classList.add('expanded');
                        currentExpandedCategory = category;
                        expandSidebar(); // å±•å¼€ä¾§è¾¹æ ä»¥æ˜¾ç¤ºå†…å®¹
                    }
                });

                categoryItem.appendChild(categoryHeader);
                categoryItem.appendChild(docList);
                menuContainer.appendChild(categoryItem);
            });
        }

        // æŠ˜å æ‰€æœ‰ä¸»åˆ†ç±»ï¼ˆé™¤äº†æŒ‡å®šçš„åˆ†ç±»ï¼‰
        function collapseAllMainCategories(exceptCategory) {
            const allCategories = document.querySelectorAll('.sidebar-category');
            
            allCategories.forEach(category => {
                const categoryName = category.getAttribute('data-category');
                if (categoryName !== exceptCategory) {
                    const header = category.querySelector('.category-header');
                    const docList = category.querySelector('.category-doc-list');
                    
                    if (docList.classList.contains('expanded')) {
                        docList.classList.remove('expanded');
                        docList.classList.add('collapsed');
                        header.classList.remove('expanded');
                    }
                }
            });
        }

        // å±•å¼€ä¾§è¾¹æ 
        function expandSidebar() {
            const sidebar = document.getElementById('sidebar');
            sidebar.classList.add('expanded');
        }

        // æ£€æŸ¥æ˜¯å¦éœ€è¦æŠ˜å ä¾§è¾¹æ 
        function checkSidebarCollapse() {
            const sidebar = document.getElementById('sidebar');
            const expandedMenus = document.querySelectorAll('.category-doc-list.expanded, .subcategory-doc-list.expanded, .subsubcategory-doc-list.expanded, .subsubsubcategory-doc-list.expanded');
            
            // å¦‚æœæ²¡æœ‰å±•å¼€çš„èœå•ï¼Œåˆ™æŠ˜å ä¾§è¾¹æ 
            if (expandedMenus.length === 0) {
                sidebar.classList.remove('expanded');
            }
        }


        // é€’å½’æ·»åŠ é¡¹ç›®åˆ°èœå•
        function addItemsToMenu(container, items, level, docMap) {
            Object.entries(items).forEach(([key, value]) => {
                // å¦‚æœå€¼æ˜¯å¯¹è±¡ï¼Œè¯´æ˜æ˜¯å­åˆ†ç±»
                if (typeof value === 'object' && !Array.isArray(value)) {
                    if (level === 1) {
                        addSubcategory(container, key, value, level, docMap);
                    } else if (level === 2) {
                        addSubsubcategory(container, key, value, level, docMap);
                    }else if (level === 3) {
                        addSubsubsubcategory(container, key, value, level, docMap);
                    }
                    // å¯ä»¥ç»§ç»­æ·»åŠ æ›´å¤šçº§åˆ«ï¼Œä½†ä¸‰çº§é€šå¸¸è¶³å¤Ÿ
                } 
                // å¦åˆ™æ˜¯æ–‡æ¡£é¡¹
                else {
                    const doc = docMap[key];
                    if (doc) {
                        addDocumentItem(container, doc);
                    } else {
                        console.warn(`æœªæ‰¾åˆ°æ–‡æ¡£é…ç½®: ${key}`);
                    }
                }
            });
        }

        // æ·»åŠ å­åˆ†ç±»
        function addSubcategory(container, subcategoryName, subcategoryItems, level, docMap) {
            const subcategoryItem = document.createElement('li');
            subcategoryItem.className = 'subcategory';

            // åˆ›å»ºå­åˆ†ç±»æ ‡é¢˜
            const subcategoryHeader = document.createElement('div');
            subcategoryHeader.className = 'subcategory-header';
            subcategoryHeader.innerHTML = `
                    <span>${subcategoryName}</span>
                    <span class="subcategory-arrow">â–¶</span>
                `;

            // åˆ›å»ºå­åˆ†ç±»æ–‡æ¡£åˆ—è¡¨
            const subcategoryDocList = document.createElement('ul');
            subcategoryDocList.className = 'subcategory-doc-list collapsed';

            // é€’å½’æ·»åŠ å­åˆ†ç±»ä¸­çš„é¡¹ç›®
            addItemsToMenu(subcategoryDocList, subcategoryItems, level + 1, docMap);

            // ç‚¹å‡»å­åˆ†ç±»æ ‡é¢˜å±•å¼€/æŠ˜å 
            subcategoryHeader.addEventListener('click', function () {
                const isExpanded = subcategoryDocList.classList.contains('expanded');
                if (isExpanded) {
                    subcategoryDocList.classList.remove('expanded');
                    subcategoryDocList.classList.add('collapsed');
                    subcategoryHeader.classList.remove('expanded');
                    checkSidebarCollapse();
                } else {
                    subcategoryDocList.classList.remove('collapsed');
                    subcategoryDocList.classList.add('expanded');
                    subcategoryHeader.classList.add('expanded');
                     expandSidebar();
                }
            });

            subcategoryItem.appendChild(subcategoryHeader);
            subcategoryItem.appendChild(subcategoryDocList);
            container.appendChild(subcategoryItem);
        }

        // æ·»åŠ ä¸‰çº§å­åˆ†ç±»
        function addSubsubcategory(container, subsubcategoryName, subsubcategoryItems, level, docMap) {
            const subsubcategoryItem = document.createElement('li');
            subsubcategoryItem.className = 'subsubcategory';

            // åˆ›å»ºå­åˆ†ç±»æ ‡é¢˜
            const subsubcategoryHeader = document.createElement('div');
            subsubcategoryHeader.className = 'subsubcategory-header';
            subsubcategoryHeader.innerHTML = `
                    <span>${subsubcategoryName}</span>
                    <span class="subsubcategory-arrow">â–¶</span>
                `;

            // åˆ›å»ºå­åˆ†ç±»æ–‡æ¡£åˆ—è¡¨
            const subsubcategoryDocList = document.createElement('ul');
            subsubcategoryDocList.className = 'subsubcategory-doc-list collapsed';

            // é€’å½’æ·»åŠ å­åˆ†ç±»ä¸­çš„é¡¹ç›®
            addItemsToMenu(subsubcategoryDocList, subsubcategoryItems, level + 1, docMap);

            // ç‚¹å‡»å­åˆ†ç±»æ ‡é¢˜å±•å¼€/æŠ˜å 
            subsubcategoryHeader.addEventListener('click', function () {
                const isExpanded = subsubcategoryDocList.classList.contains('expanded');
                if (isExpanded) {
                    subsubcategoryDocList.classList.remove('expanded');
                    subsubcategoryDocList.classList.add('collapsed');
                    subsubcategoryHeader.classList.remove('expanded');
                    checkSidebarCollapse();
                } else {
                    subsubcategoryDocList.classList.remove('collapsed');
                    subsubcategoryDocList.classList.add('expanded');
                    subsubcategoryHeader.classList.add('expanded');
                     expandSidebar();
                }
            });

            subsubcategoryItem.appendChild(subsubcategoryHeader);
            subsubcategoryItem.appendChild(subsubcategoryDocList);
            container.appendChild(subsubcategoryItem);
        }

        // æ·»åŠ å››çº§å­åˆ†ç±»
        function addSubsubsubcategory(container, subsubsubcategoryName, subsubsubcategoryItems, level, docMap) {
            const subsubsubcategoryItem = document.createElement('li');
            subsubsubcategoryItem.className = 'subsubsubcategory';

            // åˆ›å»ºå­åˆ†ç±»æ ‡é¢˜
            const subsubsubcategoryHeader = document.createElement('div');
            subsubsubcategoryHeader.className = 'subsubsubcategory-header';
            subsubsubcategoryHeader.innerHTML = `
                    <span>${subsubsubcategoryName}</span>
                    <span class="subsubsubcategory-arrow">â–¶</span>
                `;

            // åˆ›å»ºå­åˆ†ç±»æ–‡æ¡£åˆ—è¡¨
            const subsubsubcategoryDocList = document.createElement('ul');
            subsubsubcategoryDocList.className = 'subsubsubcategory-doc-list collapsed';

            // é€’å½’æ·»åŠ å­åˆ†ç±»ä¸­çš„é¡¹ç›®
            addItemsToMenu(subsubsubcategoryDocList, subsubsubcategoryItems, level + 1, docMap);

            // ç‚¹å‡»å­åˆ†ç±»æ ‡é¢˜å±•å¼€/æŠ˜å 
            subsubsubcategoryHeader.addEventListener('click', function () {
                const isExpanded = subsubsubcategoryDocList.classList.contains('expanded');
                if (isExpanded) {
                    subsubsubcategoryDocList.classList.remove('expanded');
                    subsubsubcategoryDocList.classList.add('collapsed');
                    subsubsubcategoryHeader.classList.remove('expanded');
                    checkSidebarCollapse();
                } else {
                    subsubsubcategoryDocList.classList.remove('collapsed');
                    subsubsubcategoryDocList.classList.add('expanded');
                    subsubsubcategoryHeader.classList.add('expanded');
                    expandSidebar();
                }
            });

            subsubsubcategoryItem.appendChild(subsubsubcategoryHeader);
            subsubsubcategoryItem.appendChild(subsubsubcategoryDocList);
            container.appendChild(subsubsubcategoryItem);
        }

        // æ·»åŠ æ–‡æ¡£é¡¹
        function addDocumentItem(container, doc) {
            const docListItem = document.createElement('li');
            const docLink = document.createElement('a');
            
            // æ£€æŸ¥æ˜¯å¦ä¸ºå¤–éƒ¨é“¾æ¥
            if (doc.external && doc.externalUrl) {
                // å¤–éƒ¨é“¾æ¥
                docLink.href = doc.externalUrl;
                docLink.target = "_blank";
                docLink.rel = "noopener noreferrer";
            } else {
                // å†…éƒ¨é“¾æ¥
                docLink.href = '#';
                docLink.setAttribute('data-doc', doc.id);
                docLink.classList.add('doc-link');
            }
            
            docLink.textContent = doc.title;

            docListItem.appendChild(docLink);
            container.appendChild(docListItem);
        }



        // è®¾ç½®è·¯ç”±
        function setupRouting() {
            // ç›‘å¬URLå“ˆå¸Œå˜åŒ–
            window.addEventListener('hashchange', function () {
                loadDocument(getCurrentDoc());
            });

            // ç›‘å¬æµè§ˆå™¨å‰è¿›/åé€€
            window.addEventListener('popstate', function () {
                loadDocument(getCurrentDoc());
            });
        }
        // è·å–å½“å‰æ–‡æ¡£ID
        function getCurrentDoc() {
            // ä»URLå“ˆå¸Œè·å–æ–‡æ¡£ID
            const hash = window.location.hash.substring(1);
            return hash || docConfig.defaultDoc;
        }

        // è®¾ç½®å¯¼èˆªäº‹ä»¶
        function setupNavigation() {
            // æ–‡æ¡£é“¾æ¥ç‚¹å‡»äº‹ä»¶
            document.addEventListener('click', function (e) {
                if (e.target.matches('.doc-link, .nav-link')) {
                    e.preventDefault();
                    const docId = e.target.getAttribute('data-doc');
                    if (docId) {
                        navigateToDoc(docId);
                    }
                }

                // æœç´¢åˆ‡æ¢æŒ‰é’®ç‚¹å‡»äº‹ä»¶
                if (e.target.matches('.search-toggle')) {
                    e.preventDefault();
                    toggleSearchBox();
                }
            });

            // ç‚¹å‡»é¡µé¢å…¶ä»–åœ°æ–¹æ—¶å…³é—­æœç´¢æ¡†
            document.addEventListener('click', function (e) {
                if (!e.target.closest('.sidebar-header') && !e.target.closest('.search-box')) {
                    const searchBox = document.getElementById('search-box');
                    if (searchBox.classList.contains('active')) {
                        searchBox.classList.remove('active');
                        hideSearchResults();
                    }
                }
            });
        }

        // å¯¼èˆªåˆ°æ–‡æ¡£
        function navigateToDoc(docId) {
            // æŸ¥æ‰¾æ–‡æ¡£é…ç½®
            const doc = docConfig.menu.find(d => d.id === docId);
            if (!doc) {
                console.error(`æ–‡æ¡£ä¸å­˜åœ¨: ${docId}`);
                return;
            }
            
            // å¦‚æœæ˜¯å¤–éƒ¨é“¾æ¥ï¼Œç›´æ¥è·³è½¬
            if (doc.external && doc.externalUrl) {
                window.open(doc.externalUrl, '_blank');
                return;
            }

            // å†…éƒ¨é“¾æ¥ï¼šæ›´æ–°URLå“ˆå¸Œ
            window.location.hash = docId;

            // æ›´æ–°æ´»åŠ¨çŠ¶æ€
            updateActiveState(docId);

            // åŠ è½½æ–‡æ¡£
            loadDocument(docId);

            // éšè—æœç´¢ç»“æœ
            hideSearchResults();
        }

        // æ›´æ–°æ´»åŠ¨çŠ¶æ€
        function updateActiveState(docId) {
            // ç§»é™¤æ‰€æœ‰æ´»åŠ¨çŠ¶æ€
            document.querySelectorAll('.doc-link, .nav-link').forEach(link => {
                link.classList.remove('active');
            });

            // æ·»åŠ å½“å‰æ–‡æ¡£çš„æ´»åŠ¨çŠ¶æ€
            document.querySelectorAll(`[data-doc="${docId}"]`).forEach(link => {
                link.classList.add('active');
            });
        }

        // åŠ è½½æ–‡æ¡£
        function loadDocument(docId) {
            // æ˜¾ç¤ºåŠ è½½çŠ¶æ€
            showLoading();

            // æŸ¥æ‰¾æ–‡æ¡£é…ç½®
            const doc = docConfig.menu.find(d => d.id === docId);
            if (!doc) {
                showError(`æ–‡æ¡£ä¸å­˜åœ¨: ${docId}`);
                return;
            }

            // å¦‚æœæ˜¯å¤–éƒ¨é“¾æ¥ï¼Œä¸åº”è¯¥è°ƒç”¨loadDocument
            if (doc.external) {
                console.warn(`å°è¯•åŠ è½½å¤–éƒ¨æ–‡æ¡£: ${docId}`);
                return;
            }

            console.log(`æ­£åœ¨åŠ è½½æ–‡æ¡£: ${doc.file}`); 
            // æ›´æ–°é¡µé¢æ ‡é¢˜
            document.getElementById('page-title').textContent = doc.title;

            // æ›´æ–°é¢åŒ…å±‘å¯¼èˆª
            updateBreadcrumb(doc.title);

            // åŠ è½½Markdownæ–‡ä»¶
            function tryFetchVariants(path) {
                const variants = [path];
                try {
                    const parts = path.split('/');
                    const filename = parts.pop();
                    // æ·»åŠ å°å†™æ–‡ä»¶åå˜ä½“
                    variants.push(parts.concat(filename.toLowerCase()).join('/'));
                    // æ·»åŠ å¤§å†™æ–‡ä»¶åå˜ä½“
                    variants.push(parts.concat(filename.toUpperCase()).join('/'));
                    // æ·»åŠ URIç¼–ç å˜ä½“
                    variants.push(parts.concat(encodeURIComponent(filename)).join('/'));
                    variants.push(encodeURI(path));
                } catch (e) {
                    
                }

                // æŒ‰åºå°è¯•fetchï¼Œç›´åˆ°æˆåŠŸ
                let chain = Promise.reject();
                variants.forEach(p => {
                    chain = chain.catch(() => fetch(p).then(response => {
                        if (!response.ok) {
                            return Promise.reject(new Error(`HTTP ${response.status} for ${p}`));
                        }
                        return response.text();
                    }));
                });
                    
                return chain;
            }

            tryFetchVariants(doc.file)
                .then(markdown => {
                    // è§£æMarkdown
                    const html = marked.parse(markdown);

                    // æ›´æ–°å†…å®¹
                    document.getElementById('content').innerHTML = html;

                    // é‡æ–°é«˜äº®ä»£ç å—ï¼ˆå…¼å®¹ä¸åŒç‰ˆæœ¬ï¼‰
                    document.querySelectorAll('pre code').forEach(block => {
                        try {
                            if (typeof hljs !== 'undefined') {
                                if (typeof hljs.highlightElement === 'function') {
                                    hljs.highlightElement(block);
                                } else if (typeof hljs.highlightBlock === 'function') {
                                    hljs.highlightBlock(block);
                                }
                            }
                        } catch (e) {
                            console.warn('ä»£ç å—é«˜äº®å¤±è´¥ï¼š', e);
                        }
                    });

                    // æ·»åŠ åˆ°æœç´¢ç´¢å¼•ï¼ˆå¦‚æœå°šæœªæ·»åŠ ï¼‰
                    addDocumentToSearchIndex(docId, doc.title, markdown);
                })

                .catch(error => {
                    console.error('åŠ è½½æ–‡æ¡£å¤±è´¥:', error);
                    showError(`åŠ è½½æ–‡æ¡£å¤±è´¥: ${error.message}<br>æ–‡ä»¶è·¯å¾„: ${doc.file}`);
                });
        }

        // æ˜¾ç¤ºåŠ è½½çŠ¶æ€
        function showLoading() {
            document.getElementById('content').innerHTML = `
                                <div class="loading">
                                    <div class="spinner"></div>
                                    <p>æ­£åœ¨åŠ è½½å†…å®¹...</p>
                                </div>
                            `;
        }

        // æ˜¾ç¤ºé”™è¯¯ä¿¡æ¯
        function showError(message) {
            document.getElementById('content').innerHTML = `
                                <div class="error">
                                    <h3>é”™è¯¯</h3>
                                    <p>${message}</p>
                                    <p><a href="#" data-doc="home">è¿”å›é¦–é¡µ</a></p>
                                </div>
                            `;
        }

        // æ›´æ–°é¢åŒ…å±‘å¯¼èˆª
        function updateBreadcrumb(docTitle) {
            const breadcrumb = document.getElementById('breadcrumb');
            breadcrumb.innerHTML = `
                                <a href="#" data-doc="home">é¦–é¡µ</a> > ${docTitle}
                            `;
        }

        // åˆå§‹åŒ–æœç´¢åŠŸèƒ½
        function initSearch() {
            // å¦‚æœå·²åˆå§‹åŒ–ï¼Œåˆ™ç›´æ¥è¿”å›ï¼ˆé˜²æ­¢é‡å¤ç»‘å®šäº‹ä»¶æˆ–é‡å¤æ„å»ºç´¢å¼•ï¼‰
            if (searchIndex) return;

            // åˆ›å»ºï¼ˆæˆ–é‡å»ºï¼‰æœç´¢ç´¢å¼•çš„è¾…åŠ©å‡½æ•°ä¼šåœ¨ä¸‹é¢å®šä¹‰
            rebuildSearchIndex();

            // è®¾ç½®æœç´¢è¾“å…¥äº‹ä»¶
            const searchInput = document.getElementById('search-input');
            const searchResults = document.getElementById('search-results');

            searchInput.addEventListener('input', function () {
                const query = this.value.trim();

                if (query.length < 2) {
                    hideSearchResults();
                    return;
                }

                performSearch(query);
            });

            // é¢„åŠ è½½æ‰€æœ‰æ–‡æ¡£åˆ°æœç´¢ç´¢å¼•
            preloadAllDocumentsForSearch();

            console.log("æœç´¢åŠŸèƒ½åˆå§‹åŒ–å®Œæˆ");
        }

       // é¢„åŠ è½½æ‰€æœ‰æ–‡æ¡£åˆ°æœç´¢ç´¢å¼•
        function preloadAllDocumentsForSearch() {
            console.log("å¼€å§‹é¢„åŠ è½½æ‰€æœ‰æ–‡æ¡£åˆ°æœç´¢ç´¢å¼•...");

            docConfig.menu.forEach(doc => {
                // æ£€æŸ¥æ˜¯å¦å·²ç»æ·»åŠ è¿‡
                if (documents.some(d => d.id === doc.id)) {
                    console.log(`æ–‡æ¡£å·²å­˜åœ¨ï¼Œè·³è¿‡: ${doc.title}`);
                    return;
                }

                // å¦‚æœæ˜¯å¤–éƒ¨é“¾æ¥ï¼Œä¸æ·»åŠ åˆ°æœç´¢ç´¢å¼•
                if (doc.external) {
                    console.log(`è·³è¿‡å¤–éƒ¨é“¾æ¥æ–‡æ¡£: ${doc.title}`);
                    return;
                }

                console.log(`é¢„åŠ è½½æ–‡æ¡£: ${doc.title} - ${doc.file}`);

                fetch(doc.file)
                    .then(response => {
                        if (!response.ok) {
                            console.warn(`åŠ è½½å¤±è´¥: ${doc.title} - HTTP ${response.status}`);
                            return '';
                        }
                        return response.text();
                    })
                    .then(markdown => {
                        if (markdown && markdown.trim().length > 0) {
                            addDocumentToSearchIndex(doc.id, doc.title, markdown);
                            console.log(`âœ“ æˆåŠŸé¢„åŠ è½½: ${doc.title}`);
                        } else {
                            console.warn(`å†…å®¹ä¸ºç©ºï¼Œè·³è¿‡: ${doc.title}`);
                        }
                    })
                    .catch(error => {
                        console.error(`é¢„åŠ è½½æ–‡æ¡£å¤±è´¥: ${doc.title}`, error);
                        // å³ä½¿åŠ è½½å¤±è´¥ï¼Œä¹Ÿæ·»åŠ ä¸€ä¸ªç©ºæ–‡æ¡£åˆ°ç´¢å¼•ï¼Œè‡³å°‘æ ‡é¢˜å¯ä»¥æœç´¢
                        addDocumentToSearchIndex(doc.id, doc.title, '');
                    });
            });
        }

        // é‡å»ºæœç´¢ç´¢å¼•
        function rebuildSearchIndex() {
            try {
                searchIndex = lunr(function () {
                    this.ref('id');
                    this.field('title', { boost: 10 });
                    this.field('content');
                    this.field('tags');

                    // å°†å·²æœ‰æ–‡æ¡£åŠ å…¥æ„å»ºå™¨
                    if (Array.isArray(documents) && documents.length > 0) {
                        documents.forEach(d => this.add(d));
                    }
                });
            } catch (e) {
                console.error('é‡å»ºæœç´¢ç´¢å¼•å¤±è´¥ï¼š', e);
                searchIndex = null;
            }
        }

        // åˆ‡æ¢æœç´¢æ¡†æ˜¾ç¤ºçŠ¶æ€
        function toggleSearchBox() {
            const searchBox = document.getElementById('search-box');
            searchBox.classList.toggle('active');

            if (searchBox.classList.contains('active')) {
                document.getElementById('search-input').focus();
            } else {
                hideSearchResults();
            }
        }

        // éšè—æœç´¢ç»“æœ
        function hideSearchResults() {
            document.getElementById('search-results').classList.remove('active');
        }

        // æ‰§è¡Œæœç´¢
        function performSearch(query) {
            const searchResults = document.getElementById('search-results');

            // å…ˆå°è¯• Lunr æŸ¥è¯¢ï¼ˆè‹¥å¯ç”¨ï¼‰
            let lunrResults = [];
            if (searchIndex && typeof searchIndex.search === 'function') {
                try {
                    lunrResults = searchIndex.search(query);
                } catch (e) {
                    console.warn('Lunr æŸ¥è¯¢å¤±è´¥ï¼Œé™çº§åˆ°å­å­—ç¬¦ä¸²æœç´¢ï¼š', e);
                    lunrResults = [];
                }
            }

            // å°† Lunr ç»“æœæ˜ å°„ä¸ºæ–‡æ¡£å¯¹è±¡
            let matchedDocs = [];
            if (lunrResults && lunrResults.length > 0) {
                matchedDocs = lunrResults.map(r => documents.find(d => d.id === r.ref)).filter(Boolean);
            }

            // å¦‚æœ Lunr æœªå‘½ä¸­ï¼ˆå¸¸è§äºä¸­æ–‡/æ— ç©ºæ ¼è¯­è¨€ï¼‰ï¼Œä½¿ç”¨ç®€å•çš„å­å­—ç¬¦ä¸²åŒ¹é…ä½œä¸ºåå¤‡
            if (matchedDocs.length === 0) {
                const q = query.trim().toLowerCase();
                matchedDocs = documents.filter(d => {
                    const title = (d.title || '').toLowerCase();
                    const content = (d.content || '').toLowerCase();
                    return title.includes(q) || content.includes(q);
                });
            }

            if (matchedDocs.length === 0) {
                searchResults.innerHTML = '<div class="search-result-item">æœªæ‰¾åˆ°ç›¸å…³æ–‡æ¡£</div>';
                searchResults.classList.add('active');
                return;
            }

            // æ¸²æŸ“æœç´¢ç»“æœ
            let resultsHTML = '';
            matchedDocs.slice(0, 10).forEach(doc => {
                const excerpt = createExcerpt(doc.content, query);
                resultsHTML += `
                        <div class="search-result-item" data-doc-id="${doc.id}">
                            <div class="search-result-title">${doc.title}</div>
                            <div class="search-result-excerpt">${excerpt}</div>
                        </div>
                    `;
            });

            searchResults.innerHTML = resultsHTML;
            searchResults.classList.add('active');

            // æ·»åŠ æœç´¢ç»“æœç‚¹å‡»äº‹ä»¶
            document.querySelectorAll('.search-result-item').forEach(item => {
                item.addEventListener('click', function () {
                    const docId = this.getAttribute('data-doc-id');
                    navigateToDoc(docId);
                    hideSearchResults();
                    document.getElementById('search-input').value = '';

                    // å…³é—­æœç´¢æ¡†
                    document.getElementById('search-box').classList.remove('active');
                });
            });
        }

        // åˆ›å»ºæœç´¢ç»“æœæ‘˜è¦
        function createExcerpt(content, query) {
            // ç®€å•å®ç°ï¼šæ‰¾åˆ°ç¬¬ä¸€ä¸ªåŒ…å«æŸ¥è¯¢è¯çš„å¥å­
            const sentences = content.split(/[.!?ã€‚ï¼ï¼Ÿ]/);
            const lowerQuery = query.toLowerCase();

            for (let sentence of sentences) {
                if (sentence.toLowerCase().includes(lowerQuery)) {
                    // æˆªå–é€‚å½“é•¿åº¦
                    if (sentence.length > 150) {
                        return sentence.substring(0, 150) + '...';
                    }
                    return sentence;
                }
            }

            // å¦‚æœæ²¡æœ‰æ‰¾åˆ°åŒ¹é…çš„å¥å­ï¼Œè¿”å›å‰100ä¸ªå­—ç¬¦
            return content.length > 100 ? content.substring(0, 100) + '...' : content;
        }

        

        // æ·»åŠ æ–‡æ¡£åˆ°æœç´¢ç´¢å¼•
    function addDocumentToSearchIndex(docId, title, content) {
        // æ£€æŸ¥æ˜¯å¦å·²ç»æ·»åŠ è¿‡
        const existingIndex = documents.findIndex(d => d.id === docId);
        if (existingIndex !== -1) {
            // å¦‚æœå·²å­˜åœ¨ï¼Œæ›´æ–°å†…å®¹
            documents[existingIndex].content = content || '';
        } else {
            // å‡†å¤‡æ–‡æ¡£æ•°æ®å¹¶å…ˆå­˜å‚¨åˆ°å†…å­˜åˆ—è¡¨
            const docData = {
                id: docId,
                title: title,
                content: content || ''  // ç¡®ä¿contentä¸ä¸ºundefined
            };
            documents.push(docData);
        }

        // ç¡®ä¿ç´¢å¼•å·²åˆå§‹åŒ–å¹¶é‡å»ºç´¢å¼•ä»¥åŒ…å«æ–°æ–‡æ¡£
        try {
            if (!searchIndex) {
                console.warn('searchIndex å°šæœªåˆå§‹åŒ–ï¼Œè°ƒç”¨ initSearch() ä»¥åˆå§‹åŒ–ã€‚');
                initSearch();
                return;
            }

            rebuildSearchIndex();
            console.log(`å·²æ›´æ–°æ–‡æ¡£åˆ°æœç´¢ç´¢å¼•: ${title}`);
        } catch (e) {
            console.error('å‘æœç´¢ç´¢å¼•æ·»åŠ æ–‡æ¡£å¤±è´¥ï¼š', e);
        }
    } 
    </script>
</body>
</html>