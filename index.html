<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ£±é•œé‡å·¥Wiki - çŸ¥è¯†åº“</title>
    <!-- å¼•å…¥Marked.jsåº“ç”¨äºè§£æMarkdown -->
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <!-- å¼•å…¥Highlight.jsç”¨äºä»£ç é«˜äº® -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/highlight.js/styles/github.css">
    <script src="https://cdn.jsdelivr.net/npm/highlight.js/lib/highlight.min.js"></script>
    <!-- å¼•å…¥Lunr.jsç”¨äºæœç´¢ -->
    <script src="https://cdn.jsdelivr.net/npm/lunr/lunr.min.js"></script>
    <style>
        /* åŸºç¡€æ ·å¼ */
        :root {
            --primary-color: #2c3e50;
            --secondary-color: #3498db;
            --accent-color: #e74c3c;
            --light-color: #ecf0f1;
            --dark-color: #34495e;
            --text-color: #333;
            --border-radius: 6px;
            --shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            line-height: 1.6;
            color: var(--text-color);
            background-color: #f9f9f9;
            display: flex;
            flex-direction: column;
            min-height: 100vh;
        }

        /* å¤´éƒ¨æ ·å¼ */
        header {
            background-color: var(--primary-color);
            color: white;
            padding: 1rem 2rem;
            box-shadow: var(--shadow);
        }

        .header-content {
            max-width: 1200px;
            margin: 0 auto;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .logo {
            font-size: 1.5rem;
            font-weight: bold;
        }

            .logo span {
                color: var(--secondary-color);
            }

        nav ul {
            display: flex;
            list-style: none;
        }

        nav li {
            margin-left: 1.5rem;
        }

        nav a {
            color: white;
            text-decoration: none;
            transition: color 0.3s;
        }

            nav a:hover {
                color: var(--secondary-color);
            }

        /* ä¸»ä½“å†…å®¹æ ·å¼ */
        .container {
            display: flex;
            max-width: 1200px;
            margin: 2rem auto;
            flex: 1;
            gap: 2rem;
            padding: 0 1rem;
        }

        /* ä¾§è¾¹æ æ ·å¼ */
        .sidebar {
            width: 280px;
            background-color: white;
            border-radius: var(--border-radius);
            box-shadow: var(--shadow);
            padding: 1.5rem;
            align-self: flex-start;
        }

        .sidebar-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1rem;
        }

        .sidebar h3 {
            padding-bottom: 0.5rem;
            border-bottom: 2px solid var(--secondary-color);
            flex: 1;
        }

        .search-toggle {
            background: none;
            border: none;
            color: var(--secondary-color);
            cursor: pointer;
            font-size: 1.2rem;
            margin-left: 0.5rem;
            padding: 0.2rem;
            border-radius: 3px;
            transition: background-color 0.3s;
        }

            .search-toggle:hover {
                background-color: var(--light-color);
            }

        .search-box {
            margin-bottom: 1.5rem;
            position: relative;
            display: none; /* é»˜è®¤éšè— */
        }

            .search-box.active {
                display: block; /* æ¿€æ´»æ—¶æ˜¾ç¤º */
            }

            .search-box input {
                width: 100%;
                padding: 0.5rem 2.5rem 0.5rem 0.75rem;
                border: 1px solid #ddd;
                border-radius: var(--border-radius);
                font-size: 0.9rem;
            }

                .search-box input:focus {
                    outline: none;
                    border-color: var(--secondary-color);
                    box-shadow: 0 0 0 2px rgba(52, 152, 219, 0.2);
                }

        .search-icon {
            position: absolute;
            right: 0.75rem;
            top: 50%;
            transform: translateY(-50%);
            color: #999;
        }

        .search-results {
            position: absolute;
            top: 100%;
            left: 0;
            right: 0;
            background: white;
            border: 1px solid #ddd;
            border-radius: 0 0 var(--border-radius) var(--border-radius);
            box-shadow: var(--shadow);
            z-index: 10;
            max-height: 300px;
            overflow-y: auto;
            display: none;
        }

            .search-results.active {
                display: block;
            }

        .search-result-item {
            padding: 0.75rem;
            border-bottom: 1px solid #eee;
            cursor: pointer;
            transition: background-color 0.2s;
        }

            .search-result-item:hover {
                background-color: var(--light-color);
            }

            .search-result-item:last-child {
                border-bottom: none;
            }

        .search-result-title {
            font-weight: bold;
            margin-bottom: 0.25rem;
        }

        .search-result-excerpt {
            font-size: 0.8rem;
            color: #666;
        }

        /* åµŒå¥—èœå•æ ·å¼ */
        .sidebar-category {
            margin-bottom: 0.5rem;
        }

        .category-header {
            cursor: pointer;
            padding: 0.5rem;
            font-weight: bold;
            color: var(--dark-color);
            display: flex;
            justify-content: space-between;
            align-items: center;
            transition: background-color 0.3s;
            border-radius: 4px;
        }

            .category-header:hover {
                background-color: var(--light-color);
            }

        .category-arrow {
            font-size: 0.8rem;
            transition: transform 0.3s;
        }

        .category-header.expanded .category-arrow {
            transform: rotate(90deg);
        }

        .category-doc-list {
            margin-left: 1rem;
            list-style: none;
            overflow: hidden;
            transition: max-height 0.3s ease-out;
        }

            .category-doc-list.collapsed {
                max-height: 0;
            }

            .category-doc-list.expanded {
                max-height: 500px; 
            }

            .category-doc-list li {
                margin-bottom: 0.25rem;
            }

            .category-doc-list a {
                color: var(--text-color);
                text-decoration: none;
                display: block;
                padding: 0.25rem 0.5rem;
                border-radius: 4px;
                transition: background-color 0.3s;
                font-size: 0.9rem;
            }

                .category-doc-list a:hover {
                    background-color: var(--light-color);
                }

                .category-doc-list a.active {
                    background-color: var(--secondary-color);
                    color: white;
                }

        /* ä¸»å†…å®¹åŒºæ ·å¼ */
        .main-content {
            flex: 1;
            background-color: white;
            border-radius: var(--border-radius);
            box-shadow: var(--shadow);
            padding: 2rem;
        }

            .main-content h1 {
                margin-bottom: 1.5rem;
                color: var(--primary-color);
                border-bottom: 2px solid var(--light-color);
                padding-bottom: 0.5rem;
            }

            .main-content h2 {
                margin: 1.5rem 0 1rem;
                color: var(--dark-color);
            }

            .main-content h3 {
                margin: 1.2rem 0 0.8rem;
            }

            .main-content p {
                margin-bottom: 1rem;
            }

            .main-content ul, .main-content ol {
                margin-bottom: 1rem;
                padding-left: 1.5rem;
            }

            .main-content li {
                margin-bottom: 0.5rem;
            }

            .main-content code {
                background-color: var(--light-color);
                padding: 0.2rem 0.4rem;
                border-radius: 3px;
                font-family: 'Courier New', monospace;
            }

            .main-content pre {
                background-color: #f6f8fa;
                padding: 1rem;
                border-radius: var(--border-radius);
                overflow-x: auto;
                margin-bottom: 1rem;
                border: 1px solid #e1e4e8;
            }

                .main-content pre code {
                    background: none;
                    padding: 0;
                }

            .main-content blockquote {
                border-left: 4px solid var(--secondary-color);
                padding-left: 1rem;
                margin: 1rem 0;
                color: var(--dark-color);
                font-style: italic;
            }

        .breadcrumb {
            margin-bottom: 1.5rem;
            font-size: 0.9rem;
            color: var(--dark-color);
        }

            .breadcrumb a {
                color: var(--secondary-color);
                text-decoration: none;
            }

        /* åŠ è½½çŠ¶æ€æ ·å¼ */
        .loading {
            text-align: center;
            padding: 2rem;
            color: var(--dark-color);
        }

        .spinner {
            border: 4px solid rgba(0, 0, 0, 0.1);
            border-left-color: var(--secondary-color);
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 0 auto 1rem;
        }

        @keyframes spin {
            to {
                transform: rotate(360deg);
            }
        }

        /* é”™è¯¯çŠ¶æ€æ ·å¼ */
        .error {
            background-color: #ffeaea;
            border: 1px solid #ffcccc;
            border-radius: var(--border-radius);
            padding: 1.5rem;
            margin-bottom: 1rem;
            color: #d63031;
        }

        /* å“åº”å¼è®¾è®¡ */
        @media (max-width: 768px) {
            .container {
                flex-direction: column;
            }

            .sidebar {
                width: 100%;
            }

            .header-content {
                flex-direction: column;
                text-align: center;
            }

            nav ul {
                margin-top: 1rem;
                justify-content: center;
            }

            nav li {
                margin: 0 0.75rem;
            }
        }
    </style>
</head>
<body>
    <!-- ç½‘ç«™å¤´éƒ¨ -->
    <header>
        <div class="header-content">
            <div class="logo">æ£±é•œé‡å·¥<span>Wiki</span></div>
            <nav>
                <ul>
                    <li><a href="#" class="nav-link" data-doc="home">é¦–é¡µ</a></li>
                    <li><a href="#" class="nav-link" data-doc="docs">æ–‡æ¡£</a></li>
                    <li><a href="#" class="nav-link" data-doc="guides">æŒ‡å—</a></li>
                    <li><a href="#" class="nav-link" data-doc="api">API</a></li>
                    <li><a href="#" class="nav-link" data-doc="about">å…³äº</a></li>
                </ul>
            </nav>
        </div>
    </header>

    <!-- ä¸»ä½“å†…å®¹åŒº -->
    <div class="container">
        <!-- ä¾§è¾¹æ å¯¼èˆª -->
        <aside class="sidebar">
            <div class="sidebar-header">
                <h3>æ–‡æ¡£ç›®å½•</h3>
                <button class="search-toggle" title="æœç´¢æ–‡æ¡£">ğŸ”</button>
            </div>

            <!-- æœç´¢æ¡† -->
            <div class="search-box" id="search-box">
                 <input type="text" id="search-input" placeholder="æœç´¢æ–‡æ¡£...">
                 
                <div class="search-results" id="search-results"></div>
             </div>

            <ul id="doc-menu">
                <!-- åµŒå¥—èœå•å°†é€šè¿‡JavaScriptåŠ¨æ€ç”Ÿæˆ -->
            </ul>
        </aside>

        <!-- ä¸»å†…å®¹åŒº -->
        <main class="main-content">
            <!-- é¢åŒ…å±‘å¯¼èˆª -->
            <div class="breadcrumb" id="breadcrumb">
                <a href="#" data-doc="home">é¦–é¡µ</a>
            </div>

            <!-- é¡µé¢æ ‡é¢˜ -->
            <h1 id="page-title">æ¬¢è¿ä½¿ç”¨æ£±é•œé‡å·¥Wiki</h1>

            <!-- å†…å®¹åŒºåŸŸ -->
            <div id="content">
                <!-- åˆå§‹åŠ è½½å†…å®¹ -->
                <div class="loading">
                    <div class="spinner"></div>
                    <p>æ­£åœ¨åŠ è½½å†…å®¹...</p>
                </div>
            </div>
        </main>
    </div>

    <!-- ç½‘ç«™é¡µè„š -->
    <footer>
        <div class="header-content" style="padding: 0.75rem 1rem;">
            <div style="width:100%; display:flex; justify-content:center; align-items:center; gap:0.5rem;">
                <div style="font-size:0.95rem;">&copy; 2025 æ£±é•œé‡å·¥Wiki - ç”± GitHub Pages é©±åŠ¨ Â· <a href="https://creativecommons.org/licenses/by-sa/4.0/" target="_blank" rel="noopener noreferrer">æœ¬wikiéµå¾ªCC-BY-SA-4.0è®¸å¯è¯</a></div>
            </div>
        </div>
    </footer>

    <script>
        // æ–‡æ¡£é…ç½® - åœ¨è¿™é‡Œæ·»åŠ æ–°çš„æ–‡æ¡£
        const docConfig = {
            // æ–‡æ¡£èœå•ç»“æ„
            menu: [
                { id: "home", title: "é¦–é¡µ", file: "docs/home.md" },
                { id: "getting-started", title: "å¿«é€Ÿå¼€å§‹", file: "docs/getting-started.md" },
                { id: "installation", title: "å®‰è£…æŒ‡å—", file: "docs/installation.md" },
                { id: "configuration", title: "é…ç½®è¯´æ˜", file: "docs/configuration.md" },
                { id: "philythia-lanthes", title: "è²è‰èŒœå¨…Â·å…°ç‘Ÿæ–¯", file: "docs/phi-role/Philythia-Lanthes.md" },
                { id: "troubleshooting", title: "æ•…éšœæ’é™¤", file: "docs/troubleshooting.md" },
                { id: "Update-Log", title: "æ›´æ–°æ—¥å¿—", file: "docs/Update-Log.md" },
                { id: "contributing", title: "è´¡çŒ®æŒ‡å—", file: "docs/contributing.md" },
                { id: "faq", title: "å¸¸è§é—®é¢˜", file: "docs/faq.md" },

                // æ•…äº‹åˆ†ç±»
                { id: "farewell-war", title: "æ°¸åˆ«äº†ï¼Œæˆ˜äº‰", file: "docs/advanced/Farewell-War.md" },
                { id: "polarized-light", title: "åæŒ¯å…‰", file: "docs/advanced/polarized-light.md" },
                { id: "danger-zone", title: "å±é™©åœ°å¸¦", file: "docs/advanced/Danger-Zone.md" },

                // APIæ–‡æ¡£åˆ†ç±»
                { id: "rest-api", title: "REST API", file: "docs/api/rest-api.md" },
                { id: "graphql-api", title: "GraphQL API", file: "docs/api/graphql.md" },
                { id: "websocket-api", title: "WebSocket API", file: "docs/api/websocket.md" },

                // éƒ¨ç½²åˆ†ç±»
                { id: "docker-deploy", title: "Dockeréƒ¨ç½²", file: "docs/deployment/docker.md" },
                { id: "kubernetes-deploy", title: "Kuberneteséƒ¨ç½²", file: "docs/deployment/kubernetes.md" },
                { id: "cloud-deploy", title: "äº‘å¹³å°éƒ¨ç½²", file: "docs/deployment/cloud.md" }
            ],

            // é»˜è®¤æ–‡æ¡£
            defaultDoc: "home"
        };

        // æœç´¢ç´¢å¼•å’Œæ–‡æ¡£å­˜å‚¨
        let searchIndex = null;
        let documents = [];

        // åˆå§‹åŒ–å‡½æ•°
        document.addEventListener('DOMContentLoaded', function () {
            console.log("åˆå§‹åŒ–å¼€å§‹...");

            // é…ç½®Markedé€‰é¡¹
            marked.setOptions({
                highlight: function (code, lang) {
                    try {
                        if (typeof hljs !== 'undefined') {
                            // å…¼å®¹ä¸åŒç‰ˆæœ¬çš„highlight.js API
                            if (lang && hljs.getLanguage && hljs.getLanguage(lang)) {
                                if (typeof hljs.highlight === 'function') {
                                    // æ–°API: hljs.highlight(code, {language: lang})
                                    return hljs.highlight(code, { language: lang }).value;
                                } else if (typeof hljs.highlightAuto === 'function') {
                                    return hljs.highlightAuto(code).value;
                                } else if (typeof hljs.highlightBlock === 'function') {
                                    // æ—§APIï¼ˆé™çº§ï¼‰
                                    return hljs.highlightBlock(code) || code;
                                }
                            }

                            if (typeof hljs.highlightAuto === 'function') {
                                return hljs.highlightAuto(code).value;
                            }
                        }
                    } catch (e) {
                        // å¦‚æœé«˜äº®å¤±è´¥ï¼Œè¿”å›åŸå§‹ä»£ç æ–‡æœ¬ä»¥é˜²æ­¢æŠ›å‡ºé”™è¯¯
                        console.warn('ä»£ç é«˜äº®å¤±è´¥ï¼š', e);
                    }

                    return code;
                },
                breaks: true,
                gfm: true
            });
            // å…¼å®¹æ€§åˆå§‹åŒ–é«˜äº®ï¼ˆä¼˜å…ˆæ–°APIï¼‰
            if (typeof hljs !== 'undefined') {
                if (typeof hljs.highlightAll === 'function') {
                    hljs.highlightAll();
                } else if (typeof hljs.initHighlightingOnLoad === 'function') {
                    hljs.initHighlightingOnLoad();
                }
            }

            // æ„å»ºåµŒå¥—æ–‡æ¡£èœå•
            buildNestedDocMenu();

            // è®¾ç½®è·¯ç”±
            setupRouting();

            // åˆå§‹åŒ–æœç´¢åŠŸèƒ½ï¼ˆå¿…é¡»åœ¨åŠ è½½æ–‡æ¡£ä¹‹å‰åˆå§‹åŒ–ç´¢å¼•ï¼Œé¿å… race conditionï¼‰
            initSearch();

            // è®¾ç½®å¯¼èˆªäº‹ä»¶
            setupNavigation();

            // åŠ è½½åˆå§‹æ–‡æ¡£
            loadDocument(getCurrentDoc());

            console.log("åˆå§‹åŒ–å®Œæˆ");
        });
        // æ„å»ºåµŒå¥—æ–‡æ¡£èœå•
        function buildNestedDocMenu() {
            const menuContainer = document.getElementById('doc-menu');
            menuContainer.innerHTML = '';

            // å®šä¹‰åµŒå¥—ç»“æ„
            const nestedStructure = {
                "å…¥é—¨æŒ‡å—": {
                    "home": "é¦–é¡µ",
                    "getting-started": "å¿«é€Ÿå¼€å§‹",
                     "faq": "å¸¸è§é—®é¢˜"
                },
                "æ•…äº‹": {
                    "farewell-war": "æ°¸åˆ«äº†ï¼Œæˆ˜äº‰",
                    "polarized-light": "åæŒ¯å…‰",
                    "danger-zone": "å±é™©åœ°å¸¦"
                },
                "è§’è‰²": {
                    "philythia-lanthes": "è²è‰èŒœå¨…Â·å…°ç‘Ÿæ–¯",
                    // ... å…¶ä»–è§’è‰²æ–‡æ¡£
                },
                "éƒ¨ç½²æŒ‡å—": {
                    "docker-deploy": "Dockeréƒ¨ç½²",
                    "kubernetes-deploy": "Kuberneteséƒ¨ç½²",
                    "cloud-deploy": "äº‘å¹³å°éƒ¨ç½²"
                },
                "å¼€å‘ä¸ç¤¾åŒº": {
                    "Update-Log": "æ›´æ–°æ—¥å¿—",
                    "contributing": "è´¡çŒ®æŒ‡å—"
                }
            };

            Object.entries(nestedStructure).forEach(([category, docs]) => {
                // åˆ›å»ºåˆ†ç±»å®¹å™¨
                const categoryItem = document.createElement('li');
                categoryItem.className = 'sidebar-category';

                // åˆ›å»ºåˆ†ç±»æ ‡é¢˜ï¼ˆå¯ç‚¹å‡»å±•å¼€/æŠ˜å ï¼‰
                const categoryHeader = document.createElement('div');
                categoryHeader.className = 'category-header';
                categoryHeader.innerHTML = `
                        <span>${category}</span>
                        <span class="category-arrow">â–¶</span>
                    `;

                // åˆ›å»ºæ–‡æ¡£åˆ—è¡¨å®¹å™¨
                const docList = document.createElement('ul');
                docList.className = 'category-doc-list collapsed';

                // æ·»åŠ æ–‡æ¡£é“¾æ¥
                Object.entries(docs).forEach(([docId, docTitle]) => {
                    const docListItem = document.createElement('li');
                    const docLink = document.createElement('a');
                    docLink.href = '#';
                    docLink.textContent = docTitle;
                    docLink.setAttribute('data-doc', docId);
                    docLink.classList.add('doc-link');

                    docListItem.appendChild(docLink);
                    docList.appendChild(docListItem);
                });

                // ç‚¹å‡»åˆ†ç±»æ ‡é¢˜å±•å¼€/æŠ˜å 
                categoryHeader.addEventListener('click', function () {
                    const isExpanded = docList.classList.contains('expanded');
                    if (isExpanded) {
                        docList.classList.remove('expanded');
                        docList.classList.add('collapsed');
                        categoryHeader.classList.remove('expanded');
                    } else {
                        docList.classList.remove('collapsed');
                        docList.classList.add('expanded');
                        categoryHeader.classList.add('expanded');
                    }
                });

                categoryItem.appendChild(categoryHeader);
                categoryItem.appendChild(docList);
                menuContainer.appendChild(categoryItem);
            });
        }


        // è®¾ç½®è·¯ç”±
        function setupRouting() {
            // ç›‘å¬URLå“ˆå¸Œå˜åŒ–
            window.addEventListener('hashchange', function () {
                loadDocument(getCurrentDoc());
            });

            // ç›‘å¬æµè§ˆå™¨å‰è¿›/åé€€
            window.addEventListener('popstate', function () {
                loadDocument(getCurrentDoc());
            });
        }
        // è·å–å½“å‰æ–‡æ¡£ID
        function getCurrentDoc() {
            // ä»URLå“ˆå¸Œè·å–æ–‡æ¡£ID
            const hash = window.location.hash.substring(1);
            return hash || docConfig.defaultDoc;
        }

        // è®¾ç½®å¯¼èˆªäº‹ä»¶
        function setupNavigation() {
            // æ–‡æ¡£é“¾æ¥ç‚¹å‡»äº‹ä»¶
            document.addEventListener('click', function (e) {
                if (e.target.matches('.doc-link, .nav-link')) {
                    e.preventDefault();
                    const docId = e.target.getAttribute('data-doc');
                    navigateToDoc(docId);
                }

                // æœç´¢åˆ‡æ¢æŒ‰é’®ç‚¹å‡»äº‹ä»¶
                if (e.target.matches('.search-toggle')) {
                    e.preventDefault();
                    toggleSearchBox();
                }
            });

            // ç‚¹å‡»é¡µé¢å…¶ä»–åœ°æ–¹æ—¶å…³é—­æœç´¢æ¡†
            document.addEventListener('click', function (e) {
                if (!e.target.closest('.sidebar-header') && !e.target.closest('.search-box')) {
                    const searchBox = document.getElementById('search-box');
                    if (searchBox.classList.contains('active')) {
                        searchBox.classList.remove('active');
                        hideSearchResults();
                    }
                }
            });
        }
        // å¯¼èˆªåˆ°æ–‡æ¡£
        function navigateToDoc(docId) {
            // æ›´æ–°URLå“ˆå¸Œ
            window.location.hash = docId;

            // æ›´æ–°æ´»åŠ¨çŠ¶æ€
            updateActiveState(docId);

            // åŠ è½½æ–‡æ¡£
            loadDocument(docId);

            // éšè—æœç´¢ç»“æœ
            hideSearchResults();
        }

        // æ›´æ–°æ´»åŠ¨çŠ¶æ€
        function updateActiveState(docId) {
            // ç§»é™¤æ‰€æœ‰æ´»åŠ¨çŠ¶æ€
            document.querySelectorAll('.doc-link, .nav-link').forEach(link => {
                link.classList.remove('active');
            });

            // æ·»åŠ å½“å‰æ–‡æ¡£çš„æ´»åŠ¨çŠ¶æ€
            document.querySelectorAll(`[data-doc="${docId}"]`).forEach(link => {
                link.classList.add('active');
            });
        }

        // åŠ è½½æ–‡æ¡£
        function loadDocument(docId) {
            // æ˜¾ç¤ºåŠ è½½çŠ¶æ€
            showLoading();

            // æŸ¥æ‰¾æ–‡æ¡£é…ç½®
            const doc = docConfig.menu.find(d => d.id === docId);
            if (!doc) {
                showError(`æ–‡æ¡£ä¸å­˜åœ¨: ${docId}`);
                return;
            }

            console.log(`æ­£åœ¨åŠ è½½æ–‡æ¡£: ${doc.file}`); // æ·»åŠ æ—¥å¿—
            // æ›´æ–°é¡µé¢æ ‡é¢˜
            document.getElementById('page-title').textContent = doc.title;

            // æ›´æ–°é¢åŒ…å±‘å¯¼èˆª
            updateBreadcrumb(doc.title);

            // åŠ è½½Markdownæ–‡ä»¶
            function tryFetchVariants(path) {
                const variants = [path];
                try {
                    const parts = path.split('/');
                    const filename = parts.pop();
                    // æ·»åŠ å°å†™æ–‡ä»¶åå˜ä½“
                    variants.push(parts.concat(filename.toLowerCase()).join('/'));
                    // æ·»åŠ å¤§å†™æ–‡ä»¶åå˜ä½“
                    variants.push(parts.concat(filename.toUpperCase()).join('/'));
                    // æ·»åŠ URIç¼–ç å˜ä½“
                    variants.push(parts.concat(encodeURIComponent(filename)).join('/'));
                    variants.push(encodeURI(path));
                } catch (e) {
                    // ignore
                }

                // æŒ‰åºå°è¯•fetchï¼Œç›´åˆ°æˆåŠŸ
                let chain = Promise.reject();
                variants.forEach(p => {
                    chain = chain.catch(() => fetch(p).then(response => {
                        if (!response.ok) {
                            return Promise.reject(new Error(`HTTP ${response.status} for ${p}`));
                        }
                        return response.text();
                    }));
                });

                return chain;
            }

            tryFetchVariants(doc.file)
                .then(markdown => {
                    // è§£æMarkdown
                    const html = marked.parse(markdown);

                    // æ›´æ–°å†…å®¹
                    document.getElementById('content').innerHTML = html;

                    // é‡æ–°é«˜äº®ä»£ç å—ï¼ˆå…¼å®¹ä¸åŒç‰ˆæœ¬ï¼‰
                    document.querySelectorAll('pre code').forEach(block => {
                        try {
                            if (typeof hljs !== 'undefined') {
                                if (typeof hljs.highlightElement === 'function') {
                                    hljs.highlightElement(block);
                                } else if (typeof hljs.highlightBlock === 'function') {
                                    hljs.highlightBlock(block);
                                }
                            }
                        } catch (e) {
                            console.warn('ä»£ç å—é«˜äº®å¤±è´¥ï¼š', e);
                        }
                    });

                    // æ·»åŠ åˆ°æœç´¢ç´¢å¼•ï¼ˆå¦‚æœå°šæœªæ·»åŠ ï¼‰
                    addDocumentToSearchIndex(docId, doc.title, markdown);
                })
                .catch(error => {
                    console.error('åŠ è½½æ–‡æ¡£å¤±è´¥:', error);
                    showError(`åŠ è½½æ–‡æ¡£å¤±è´¥: ${error.message}<br>æ–‡ä»¶è·¯å¾„: ${doc.file}`);
                });
        }

        // æ˜¾ç¤ºåŠ è½½çŠ¶æ€
        function showLoading() {
            document.getElementById('content').innerHTML = `
                                <div class="loading">
                                    <div class="spinner"></div>
                                    <p>æ­£åœ¨åŠ è½½å†…å®¹...</p>
                                </div>
                            `;
        }

        // æ˜¾ç¤ºé”™è¯¯ä¿¡æ¯
        function showError(message) {
            document.getElementById('content').innerHTML = `
                                <div class="error">
                                    <h3>é”™è¯¯</h3>
                                    <p>${message}</p>
                                    <p><a href="#" data-doc="home">è¿”å›é¦–é¡µ</a></p>
                                </div>
                            `;
        }

        // æ›´æ–°é¢åŒ…å±‘å¯¼èˆª
        function updateBreadcrumb(docTitle) {
            const breadcrumb = document.getElementById('breadcrumb');
            breadcrumb.innerHTML = `
                                <a href="#" data-doc="home">é¦–é¡µ</a> > ${docTitle}
                            `;
        }

        // åˆå§‹åŒ–æœç´¢åŠŸèƒ½
        function initSearch() {
            // å¦‚æœå·²åˆå§‹åŒ–ï¼Œåˆ™ç›´æ¥è¿”å›ï¼ˆé˜²æ­¢é‡å¤ç»‘å®šäº‹ä»¶æˆ–é‡å¤æ„å»ºç´¢å¼•ï¼‰
            if (searchIndex) return;
            // åˆ›å»ºï¼ˆæˆ–é‡å»ºï¼‰æœç´¢ç´¢å¼•çš„è¾…åŠ©å‡½æ•°ä¼šåœ¨ä¸‹é¢å®šä¹‰
            rebuildSearchIndex();

            // è®¾ç½®æœç´¢è¾“å…¥äº‹ä»¶
            const searchInput = document.getElementById('search-input');
            const searchResults = document.getElementById('search-results');

            searchInput.addEventListener('input', function () {
                const query = this.value.trim();

                if (query.length < 2) {
                    hideSearchResults();
                    return;
                }

                performSearch(query);
            });

            // é¢„åŠ è½½æ‰€æœ‰æ–‡æ¡£åˆ°æœç´¢ç´¢å¼•
            preloadAllDocumentsForSearch();

            console.log("æœç´¢åŠŸèƒ½åˆå§‹åŒ–å®Œæˆ");
        }

        // é¢„åŠ è½½æ‰€æœ‰æ–‡æ¡£åˆ°æœç´¢ç´¢å¼•
        function preloadAllDocumentsForSearch() {
            console.log("å¼€å§‹é¢„åŠ è½½æ‰€æœ‰æ–‡æ¡£åˆ°æœç´¢ç´¢å¼•...");

            docConfig.menu.forEach(doc => {
                // æ£€æŸ¥æ˜¯å¦å·²ç»æ·»åŠ è¿‡
                if (documents.some(d => d.id === doc.id)) {
                    console.log(`æ–‡æ¡£å·²å­˜åœ¨ï¼Œè·³è¿‡: ${doc.title}`);
                    return;
                }

                console.log(`é¢„åŠ è½½æ–‡æ¡£: ${doc.title} - ${doc.file}`);

                fetch(doc.file)
                    .then(response => {
                        if (!response.ok) {
                            console.warn(`åŠ è½½å¤±è´¥: ${doc.title} - HTTP ${response.status}`);
                            return '';
                        }
                        return response.text();
                    })
                    .then(markdown => {
                        if (markdown && markdown.trim().length > 0) {
                            addDocumentToSearchIndex(doc.id, doc.title, markdown);
                            console.log(`âœ“ æˆåŠŸé¢„åŠ è½½: ${doc.title}`);
                        } else {
                            console.warn(`å†…å®¹ä¸ºç©ºï¼Œè·³è¿‡: ${doc.title}`);
                        }
                    })
                    .catch(error => {
                        console.error(`é¢„åŠ è½½æ–‡æ¡£å¤±è´¥: ${doc.title}`, error);
                        // å³ä½¿åŠ è½½å¤±è´¥ï¼Œä¹Ÿæ·»åŠ ä¸€ä¸ªç©ºæ–‡æ¡£åˆ°ç´¢å¼•ï¼Œè‡³å°‘æ ‡é¢˜å¯ä»¥æœç´¢
                        addDocumentToSearchIndex(doc.id, doc.title, '');
                    });
            });
        }

        // é‡å»ºæœç´¢ç´¢å¼•ï¼ˆLunr åœ¨æ„å»ºåè¿”å›çš„ Index å¯¹è±¡é€šå¸¸ä¸å†æ”¯æŒ .addï¼Œ
        // å› æ­¤æˆ‘ä»¬åœ¨æ¯æ¬¡æ·»åŠ æ–‡æ¡£åé€šè¿‡å½“å‰ documents åˆ—è¡¨é‡å»ºç´¢å¼•ï¼‰
        function rebuildSearchIndex() {
            try {
                searchIndex = lunr(function () {
                    this.ref('id');
                    this.field('title', { boost: 10 });
                    this.field('content');
                    this.field('tags');

                    // å°†å·²æœ‰æ–‡æ¡£åŠ å…¥æ„å»ºå™¨
                    if (Array.isArray(documents) && documents.length > 0) {
                        documents.forEach(d => this.add(d));
                    }
                });
            } catch (e) {
                console.error('é‡å»ºæœç´¢ç´¢å¼•å¤±è´¥ï¼š', e);
                searchIndex = null;
            }
        }

        // åˆ‡æ¢æœç´¢æ¡†æ˜¾ç¤ºçŠ¶æ€
        function toggleSearchBox() {
            const searchBox = document.getElementById('search-box');
            searchBox.classList.toggle('active');

            if (searchBox.classList.contains('active')) {
                document.getElementById('search-input').focus();
            } else {
                hideSearchResults();
            }
        }

        // éšè—æœç´¢ç»“æœ
        function hideSearchResults() {
            document.getElementById('search-results').classList.remove('active');
        }

        // æ‰§è¡Œæœç´¢
        function performSearch(query) {
            const searchResults = document.getElementById('search-results');

            // å…ˆå°è¯• Lunr æŸ¥è¯¢ï¼ˆè‹¥å¯ç”¨ï¼‰
            let lunrResults = [];
            if (searchIndex && typeof searchIndex.search === 'function') {
                try {
                    lunrResults = searchIndex.search(query);
                } catch (e) {
                    console.warn('Lunr æŸ¥è¯¢å¤±è´¥ï¼Œé™çº§åˆ°å­å­—ç¬¦ä¸²æœç´¢ï¼š', e);
                    lunrResults = [];
                }
            }

            // å°† Lunr ç»“æœæ˜ å°„ä¸ºæ–‡æ¡£å¯¹è±¡
            let matchedDocs = [];
            if (lunrResults && lunrResults.length > 0) {
                matchedDocs = lunrResults.map(r => documents.find(d => d.id === r.ref)).filter(Boolean);
            }

            // å¦‚æœ Lunr æœªå‘½ä¸­ï¼ˆå¸¸è§äºä¸­æ–‡/æ— ç©ºæ ¼è¯­è¨€ï¼‰ï¼Œä½¿ç”¨ç®€å•çš„å­å­—ç¬¦ä¸²åŒ¹é…ä½œä¸ºåå¤‡
            if (matchedDocs.length === 0) {
                const q = query.trim().toLowerCase();
                matchedDocs = documents.filter(d => {
                    const title = (d.title || '').toLowerCase();
                    const content = (d.content || '').toLowerCase();
                    return title.includes(q) || content.includes(q);
                });
            }

            if (matchedDocs.length === 0) {
                searchResults.innerHTML = '<div class="search-result-item">æœªæ‰¾åˆ°ç›¸å…³æ–‡æ¡£</div>';
                searchResults.classList.add('active');
                return;
            }

            // æ¸²æŸ“æœç´¢ç»“æœ
            let resultsHTML = '';
            matchedDocs.slice(0, 10).forEach(doc => {
                const excerpt = createExcerpt(doc.content, query);
                resultsHTML += `
                        <div class="search-result-item" data-doc-id="${doc.id}">
                            <div class="search-result-title">${doc.title}</div>
                            <div class="search-result-excerpt">${excerpt}</div>
                        </div>
                    `;
            });

            searchResults.innerHTML = resultsHTML;
            searchResults.classList.add('active');

            // æ·»åŠ æœç´¢ç»“æœç‚¹å‡»äº‹ä»¶
            document.querySelectorAll('.search-result-item').forEach(item => {
                item.addEventListener('click', function () {
                    const docId = this.getAttribute('data-doc-id');
                    navigateToDoc(docId);
                    hideSearchResults();
                    document.getElementById('search-input').value = '';

                    // å…³é—­æœç´¢æ¡†
                    document.getElementById('search-box').classList.remove('active');
                });
            });
        }

        // åˆ›å»ºæœç´¢ç»“æœæ‘˜è¦
        function createExcerpt(content, query) {
            // ç®€å•å®ç°ï¼šæ‰¾åˆ°ç¬¬ä¸€ä¸ªåŒ…å«æŸ¥è¯¢è¯çš„å¥å­
            const sentences = content.split(/[.!?ã€‚ï¼ï¼Ÿ]/);
            const lowerQuery = query.toLowerCase();

            for (let sentence of sentences) {
                if (sentence.toLowerCase().includes(lowerQuery)) {
                    // æˆªå–é€‚å½“é•¿åº¦
                    if (sentence.length > 150) {
                        return sentence.substring(0, 150) + '...';
                    }
                    return sentence;
                }
            }

            // å¦‚æœæ²¡æœ‰æ‰¾åˆ°åŒ¹é…çš„å¥å­ï¼Œè¿”å›å‰100ä¸ªå­—ç¬¦
            return content.length > 100 ? content.substring(0, 100) + '...' : content;
        }

        // ä¸ºæœç´¢åŠ è½½æ–‡æ¡£
        function loadDocumentForSearch(docId) {
            const doc = docConfig.menu.find(d => d.id === docId);
            if (!doc) return;

            // æ£€æŸ¥æ˜¯å¦å·²ç»æ·»åŠ è¿‡
            if (documents.some(d => d.id === docId)) return;

            fetch(doc.file)
                .then(response => {
                    if (!response.ok) return '';
                    return response.text();
                })
                .then(markdown => {
                    // æ·»åŠ åˆ°æœç´¢ç´¢å¼•
                    addDocumentToSearchIndex(docId, doc.title, markdown);
                })
                .catch(error => {
                    console.error('åŠ è½½æ–‡æ¡£ç”¨äºæœç´¢å¤±è´¥:', error);
                });
        }

        // æ·»åŠ æ–‡æ¡£åˆ°æœç´¢ç´¢å¼•
        function addDocumentToSearchIndex(docId, title, content) {
            // æ£€æŸ¥æ˜¯å¦å·²ç»æ·»åŠ è¿‡
            const existingIndex = documents.findIndex(d => d.id === docId);
            if (existingIndex !== -1) {
                // å¦‚æœå·²å­˜åœ¨ï¼Œæ›´æ–°å†…å®¹
                documents[existingIndex].content = content || '';
            } else {
                // å‡†å¤‡æ–‡æ¡£æ•°æ®å¹¶å…ˆå­˜å‚¨åˆ°å†…å­˜åˆ—è¡¨
                const docData = {
                    id: docId,
                    title: title,
                    content: content || ''  // ç¡®ä¿contentä¸ä¸ºundefined
                };
                documents.push(docData);
            }

            // ç¡®ä¿ç´¢å¼•å·²åˆå§‹åŒ–å¹¶é‡å»ºç´¢å¼•ä»¥åŒ…å«æ–°æ–‡æ¡£
            try {
                if (!searchIndex) {
                    console.warn('searchIndex å°šæœªåˆå§‹åŒ–ï¼Œè°ƒç”¨ initSearch() ä»¥åˆå§‹åŒ–ã€‚');
                    initSearch();
                    return;
                }

                rebuildSearchIndex();
                console.log(`å·²æ›´æ–°æ–‡æ¡£åˆ°æœç´¢ç´¢å¼•: ${title}`);
            } catch (e) {
                console.error('å‘æœç´¢ç´¢å¼•æ·»åŠ æ–‡æ¡£å¤±è´¥ï¼š', e);
            }
        
        }
    </script>
</body>

</html>


